<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>hookeai.miscellaneous.pruning.pruning_dataset &mdash; hookeai 1.0.0 documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/readthedocs-custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/sphinx_highlight.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            hookeai
          </a>
              <div class="version">
                1.0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../rst_doc_files/getting_started/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../rst_doc_files/getting_started/installation.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../rst_doc_files/features/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../rst_doc_files/features/data_generation.html">Data generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../rst_doc_files/features/material_models.html">Material model architectures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../rst_doc_files/features/local_model_updating.html">Local material model updating</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../rst_doc_files/features/global_model_updating.html">Global material model updating</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../rst_doc_files/features/data_analysis.html">Data analysis and visualization tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../rst_doc_files/features/tensor_matrix.html">Tensorial algebra and matrix operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../rst_doc_files/features/other.html">Other utilities</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../_autosummary/hookeai.html">Code</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">License</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../license.html">MIT License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">hookeai</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">hookeai.miscellaneous.pruning.pruning_dataset</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for hookeai.miscellaneous.pruning.pruning_dataset</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Pruning procedure of time series data set.</span>

<span class="sd">Functions</span>
<span class="sd">---------</span>
<span class="sd">prune_time_series_dataset</span>
<span class="sd">    Prune time series data set.</span>
<span class="sd">setup_pruning_dirs</span>
<span class="sd">    Setup main pruning process directories.</span>
<span class="sd">set_pruning_iter_dir</span>
<span class="sd">    Setup pruning iteration directory.</span>
<span class="sd">set_default_pruning_parameters</span>
<span class="sd">    Set default pruning parameters.</span>
<span class="sd">get_n_prun_sample</span>
<span class="sd">    Get number of pruned samples.</span>
<span class="sd">perform_pruning_step</span>
<span class="sd">    Perform pruning step.</span>
<span class="sd">set_pruning_step_dir</span>
<span class="sd">    Setup pruning iteration directory.</span>
<span class="sd">write_summary_file</span>
<span class="sd">    Write summary file.</span>
<span class="sd">load_full_dataset</span>
<span class="sd">    Load full data set.</span>
<span class="sd">read_samples_loss_from_dir</span>
<span class="sd">    Read loss samples from prediction directory.</span>
<span class="sd">plot_pruning_iterative_data</span>
<span class="sd">    Plot pruning iterative data.</span>
<span class="sd">display_pruning_data</span>
<span class="sd">    Display data from pruning data file.</span>
<span class="sd">preview_pruning_iterations</span>
<span class="sd">    Preview pruning iterations.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1">#</span>
<span class="c1">#                                                                       Modules</span>
<span class="c1"># =============================================================================</span>
<span class="c1"># Standard</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pathlib</span>
<span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="c1"># Add project root directory to sys.path</span>
<span class="n">root_dir</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="k">if</span> <span class="n">root_dir</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">root_dir</span><span class="p">)</span>
<span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
<span class="c1"># Third-party</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="c1"># Local</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">time_series_data.time_dataset</span><span class="w"> </span><span class="kn">import</span> <span class="n">save_dataset</span><span class="p">,</span> <span class="n">load_dataset</span><span class="p">,</span> \
    <span class="n">split_dataset</span><span class="p">,</span> <span class="n">get_parent_dataset_indices</span><span class="p">,</span> <span class="n">TimeSeriesDatasetInMemory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">user_scripts.local_model_update.rnn_material_model.train_model</span><span class="w"> </span><span class="kn">import</span> \
    <span class="n">perform_model_standard_training</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">user_scripts.local_model_update.rnn_material_model.predict</span><span class="w"> </span><span class="kn">import</span> \
    <span class="n">perform_model_prediction</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ioput.plots</span><span class="w"> </span><span class="kn">import</span> <span class="n">plot_xy_data</span><span class="p">,</span> <span class="n">save_figure</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ioput.iostandard</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_directory</span><span class="p">,</span> <span class="n">find_unique_file_with_regex</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">utilities.output_prediction_metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">read_mean_metrics_results_file</span>
<span class="c1">#</span>
<span class="c1">#                                                          Authorship &amp; Credits</span>
<span class="c1"># =============================================================================</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;Bernardo Ferreira (bernardo_ferreira@brown.edu)&#39;</span>
<span class="n">__credits__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Bernardo Ferreira&#39;</span><span class="p">,</span> <span class="p">]</span>
<span class="n">__status__</span> <span class="o">=</span> <span class="s1">&#39;Stable&#39;</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<div class="viewcode-block" id="prune_time_series_dataset"><a class="viewcode-back" href="../../../../_autosummary/hookeai.miscellaneous.pruning.pruning_dataset.prune_time_series_dataset.html#hookeai.miscellaneous.pruning.pruning_dataset.prune_time_series_dataset">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">prune_time_series_dataset</span><span class="p">(</span><span class="n">pruning_dir</span><span class="p">,</span> <span class="n">testing_types</span><span class="p">,</span> <span class="n">pruning_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">is_remove_pruning_models</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                              <span class="n">device_type</span><span class="o">=</span><span class="s1">&#39;cpu&#39;</span><span class="p">,</span> <span class="n">is_verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Prune time series data set.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pruning_dir : str</span>
<span class="sd">        Pruning main directory.</span>
<span class="sd">    testing_types : tuple[str]</span>
<span class="sd">        Types of testing data sets used to assess the performance of the model</span>
<span class="sd">        trained on the pruned training data sets. Available testing types</span>
<span class="sd">        include: &#39;in_distribution&#39;, &#39;out_distribution&#39; and &#39;unused_data&#39;.</span>
<span class="sd">    pruning_params : dict, default=None</span>
<span class="sd">        Pruning parameters. If None, then a default set of pruning parameters</span>
<span class="sd">        is adopted.</span>
<span class="sd">    is_remove_pruning_models : bool, default=False</span>
<span class="sd">        If True, then remove pruning iteration models when pruning iteration is</span>
<span class="sd">        complete.</span>
<span class="sd">    device_type : {&#39;cpu&#39;, &#39;cuda&#39;}, default=&#39;cpu&#39;</span>
<span class="sd">        Type of device on which torch.Tensor is allocated.</span>
<span class="sd">    is_verbose : bool, default=False</span>
<span class="sd">        If True, enable verbose output.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pruning_params : dict</span>
<span class="sd">        Pruning parameters.</span>
<span class="sd">    pruning_iterative_data : dict</span>
<span class="sd">        Pruning iterative data (item, dict) for each pruning iteration</span>
<span class="sd">        (key, str).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start_time_sec</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">is_verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Time series data set pruning&#39;</span>
              <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">----------------------------&#39;</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Setup main pruning process directories</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">prun_datasets_dir</span><span class="p">,</span> <span class="n">full_dataset_dir</span><span class="p">,</span> \
        <span class="n">test_dataset_dirs</span> <span class="o">=</span> <span class="n">setup_pruning_dirs</span><span class="p">(</span><span class="n">pruning_dir</span><span class="p">,</span> <span class="n">testing_types</span><span class="p">)</span> 
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="k">if</span> <span class="n">is_verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&gt; Loading full data set...&#39;</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Load full data set</span>
    <span class="n">full_dataset</span> <span class="o">=</span> <span class="n">TimeSeriesDatasetInMemory</span><span class="o">.</span><span class="n">from_dataset</span><span class="p">(</span>
        <span class="n">load_full_dataset</span><span class="p">(</span><span class="n">full_dataset_dir</span><span class="p">))</span>
    <span class="c1"># Get full data set size</span>
    <span class="n">n_full</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">full_dataset</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Get default pruning parameters</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pruning_params</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">pruning_params</span> <span class="o">=</span> <span class="n">set_default_pruning_parameters</span><span class="p">()</span>
    <span class="c1"># Get maximum number of pruning iterations</span>
    <span class="n">n_iter_max</span> <span class="o">=</span> <span class="n">pruning_params</span><span class="p">[</span><span class="s1">&#39;n_iter_max&#39;</span><span class="p">]</span>
    <span class="c1"># Get pruning iteration data set split sizes</span>
    <span class="n">pruning_iter_sizes</span> <span class="o">=</span> <span class="n">pruning_params</span><span class="p">[</span><span class="s1">&#39;pruning_iter_sizes&#39;</span><span class="p">]</span>
    <span class="c1"># Add full data set size to pruning parameters</span>
    <span class="n">pruning_params</span><span class="p">[</span><span class="s1">&#39;n_full&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_full</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Initialize summary file</span>
    <span class="n">write_summary_file</span><span class="p">(</span><span class="n">pruning_dir</span><span class="p">,</span> <span class="n">pruning_params</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;init&#39;</span><span class="p">)</span>
    <span class="c1"># Initialize pruning iterative data</span>
    <span class="n">pruning_iterative_data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="k">if</span> <span class="n">is_verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&gt; Initializing pruning iterative loop...&#39;</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Initialize pruning iteration counter</span>
    <span class="nb">iter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Initialize pruning termination flag</span>
    <span class="n">is_keep_pruning</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># Loop over iterations</span>
    <span class="k">while</span> <span class="n">is_keep_pruning</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">is_verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&gt; Pruning iteration </span><span class="si">{</span><span class="nb">iter</span><span class="si">}</span><span class="s1">:&#39;</span><span class="p">)</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Build development data set</span>
        <span class="k">if</span> <span class="nb">iter</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Initialize development data set</span>
            <span class="n">dev_dataset</span> <span class="o">=</span> <span class="n">full_dataset</span>
            <span class="c1"># Initialize unused data set</span>
            <span class="n">unused_dataset</span> <span class="o">=</span> <span class="n">TimeSeriesDatasetInMemory</span><span class="p">([])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">  &gt; Performing pruning step...&#39;</span><span class="p">)</span>
            <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
            <span class="c1"># Perform pruning step</span>
            <span class="n">is_valid_pruning_step</span><span class="p">,</span> <span class="n">step_status</span><span class="p">,</span> <span class="n">dev_dataset</span><span class="p">,</span> <span class="n">unused_dataset</span> <span class="o">=</span> \
                <span class="n">perform_pruning_step</span><span class="p">(</span><span class="n">prun_datasets_dir</span><span class="p">,</span> <span class="n">pruning_params</span><span class="p">,</span>
                                     <span class="n">dev_dataset</span><span class="p">,</span> <span class="n">unused_dataset</span><span class="p">,</span>
                                     <span class="n">device_type</span><span class="o">=</span><span class="n">device_type</span><span class="p">,</span>
                                     <span class="n">is_verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
            <span class="c1"># Check pruning step admissibility</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_valid_pruning_step</span><span class="p">:</span>
                <span class="c1"># Set termination status</span>
                <span class="n">termination_status</span> <span class="o">=</span> <span class="n">step_status</span>
                <span class="c1"># Terminate pruning</span>
                <span class="n">is_keep_pruning</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">continue</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="k">if</span> <span class="n">is_verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">  &gt; Development data set size ratio: &#39;</span>
                  <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dev_dataset</span><span class="p">)</span><span class="o">/</span><span class="n">n_full</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s1">&gt;6.1f</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Randomly split development data set</span>
        <span class="n">dev_dataset_split</span> <span class="o">=</span> <span class="n">split_dataset</span><span class="p">(</span><span class="n">dev_dataset</span><span class="p">,</span> <span class="n">pruning_iter_sizes</span><span class="p">)</span>
        <span class="c1"># Get pruning iteration data sets</span>
        <span class="n">train_dataset</span> <span class="o">=</span> <span class="n">dev_dataset_split</span><span class="p">[</span><span class="s1">&#39;training&#39;</span><span class="p">]</span>
        <span class="n">val_dataset</span> <span class="o">=</span> <span class="n">dev_dataset_split</span><span class="p">[</span><span class="s1">&#39;validation&#39;</span><span class="p">]</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Set pruning iteration directory</span>
        <span class="n">pruning_iter_dir</span><span class="p">,</span> <span class="n">model_directory</span><span class="p">,</span> <span class="n">train_dataset_file_path</span><span class="p">,</span> \
            <span class="n">val_dataset_file_path</span><span class="p">,</span> <span class="n">test_dataset_file_paths</span><span class="p">,</span> \
                <span class="n">test_prediction_dirs</span> <span class="o">=</span> \
                    <span class="n">set_pruning_iter_dir</span><span class="p">(</span><span class="n">prun_datasets_dir</span><span class="p">,</span> <span class="n">train_dataset</span><span class="p">,</span>
                                         <span class="n">val_dataset</span><span class="p">,</span>
                                         <span class="n">test_dataset_dirs</span><span class="o">=</span><span class="n">test_dataset_dirs</span><span class="p">,</span>
                                         <span class="n">unused_dataset</span><span class="o">=</span><span class="n">unused_dataset</span><span class="p">)</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="k">if</span> <span class="n">is_verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">  &gt; Performing pruning iteration model training...&#39;</span><span class="p">)</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Perform pruning iteration model standard training</span>
        <span class="n">perform_model_standard_training</span><span class="p">(</span>
            <span class="n">train_dataset_file_path</span><span class="p">,</span> <span class="n">model_directory</span><span class="p">,</span>
            <span class="n">val_dataset_file_path</span><span class="o">=</span><span class="n">val_dataset_file_path</span><span class="p">,</span>
            <span class="n">device_type</span><span class="o">=</span><span class="n">device_type</span><span class="p">,</span> <span class="n">is_verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Initialize pruning iteration model testing loss</span>
        <span class="n">testing_types_loss</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Initialize pruning iteration model average prediction metric</span>
        <span class="n">testing_types_avg_nrmse</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Loop over testing types</span>
        <span class="k">for</span> <span class="n">testing_type</span> <span class="ow">in</span> <span class="n">testing_types</span><span class="p">:</span>
            <span class="c1"># Get testing type prediction directory</span>
            <span class="n">prediction_subdir</span> <span class="o">=</span> <span class="n">test_prediction_dirs</span><span class="p">[</span><span class="n">testing_type</span><span class="p">]</span>
            <span class="c1"># Get testing type data set file path</span>
            <span class="n">test_dataset_file_path</span> <span class="o">=</span> <span class="n">test_dataset_file_paths</span><span class="p">[</span><span class="n">testing_type</span><span class="p">]</span>
            <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
            <span class="c1"># Perform pruning iteration model prediction</span>
            <span class="k">if</span> <span class="n">testing_type</span> <span class="o">==</span> <span class="s1">&#39;unused_data&#39;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">unused_dataset</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Set testing loss if testing data set is null</span>
                <span class="n">avg_predict_loss</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="c1"># Set average prediction metric to None if testing data set is</span>
                <span class="c1"># null</span>
                <span class="n">avg_predict_nrmse</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">is_verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">  &gt; Performing pruning iteration model testing &#39;</span>
                          <span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="n">testing_type</span><span class="si">}</span><span class="s1">)...&#39;</span><span class="p">)</span>
                <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
                <span class="c1"># Perform pruning iteration model prediction</span>
                <span class="n">predict_subdir</span><span class="p">,</span> <span class="n">avg_predict_loss</span> <span class="o">=</span> <span class="n">perform_model_prediction</span><span class="p">(</span>
                    <span class="n">prediction_subdir</span><span class="p">,</span> <span class="n">test_dataset_file_path</span><span class="p">,</span> <span class="n">model_directory</span><span class="p">,</span>
                    <span class="n">is_remove_sample_prediction</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">device_type</span><span class="o">=</span><span class="n">device_type</span><span class="p">,</span> <span class="n">is_verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
                <span class="c1"># Initialize average prediction metric</span>
                <span class="n">avg_predict_nrmse</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="c1"># Set prediction metrics directory</span>
                <span class="n">prediction_metrics_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">predict_subdir</span><span class="p">),</span> <span class="s1">&#39;prediction_metrics&#39;</span><span class="p">)</span>
                <span class="c1"># Collect prediction metrics</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">prediction_metrics_dir</span><span class="p">):</span>
                    <span class="c1"># Set mean prediction metrics file</span>
                    <span class="n">mean_predictions_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">prediction_metrics_dir</span><span class="p">),</span>
                        <span class="s1">&#39;mean_prediction_metrics.dat&#39;</span><span class="p">)</span>
                    <span class="c1"># Check mean prediction metrics file</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">mean_predictions_file_path</span><span class="p">):</span>
                        <span class="c1"># Read mean prediction metrics</span>
                        <span class="n">mean_metrics_results</span> <span class="o">=</span> <span class="n">read_mean_metrics_results_file</span><span class="p">(</span>
                            <span class="n">mean_predictions_file_path</span><span class="p">)</span>
                        <span class="c1"># Compute average prediction metric</span>
                        <span class="n">avg_predict_nrmse</span> <span class="o">=</span> \
                            <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mean_metrics_results</span><span class="p">[</span><span class="s1">&#39;nrmse&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
            <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
            <span class="c1"># Store testing loss</span>
            <span class="n">testing_types_loss</span><span class="p">[</span><span class="n">testing_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">avg_predict_loss</span>
            <span class="c1"># Store average prediction metric</span>
            <span class="n">testing_types_avg_nrmse</span><span class="p">[</span><span class="n">testing_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">avg_predict_nrmse</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Remove pruning iteration model</span>
        <span class="k">if</span> <span class="n">is_remove_pruning_models</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">model_directory</span><span class="p">)</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Build pruning iteration data</span>
        <span class="n">iter_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n_full&#39;</span><span class="p">:</span> <span class="n">n_full</span><span class="p">,</span>
                     <span class="s1">&#39;iter&#39;</span><span class="p">:</span> <span class="nb">iter</span><span class="p">,</span>
                     <span class="s1">&#39;n_dev&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">dev_dataset</span><span class="p">),</span>
                     <span class="s1">&#39;n_train&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">),</span>
                     <span class="s1">&#39;n_valid&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">val_dataset</span><span class="p">),</span>
                     <span class="s1">&#39;n_unused&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">unused_dataset</span><span class="p">),</span>
                     <span class="s1">&#39;testing_types_loss&#39;</span><span class="p">:</span> <span class="n">testing_types_loss</span><span class="p">,</span>
                     <span class="s1">&#39;testing_types_avg_nrmse&#39;</span><span class="p">:</span> <span class="n">testing_types_avg_nrmse</span><span class="p">}</span>     
        <span class="c1"># Add pruning iteration data to summary file</span>
        <span class="n">write_summary_file</span><span class="p">(</span><span class="n">pruning_dir</span><span class="p">,</span> <span class="n">pruning_params</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;iter&#39;</span><span class="p">,</span>
                           <span class="n">mode_data</span><span class="o">=</span><span class="n">iter_data</span><span class="p">)</span>
        <span class="c1"># Store pruning iteration data</span>
        <span class="n">pruning_iterative_data</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">iter</span><span class="p">)]</span> <span class="o">=</span> <span class="n">iter_data</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="k">if</span> <span class="n">is_verbose</span><span class="p">:</span>
            <span class="n">total_time_sec</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time_sec</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">  &gt; Total elapsed time (s): &#39;</span>
                  <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">total_time_sec</span><span class="p">)))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Check pruning iterations</span>
        <span class="k">if</span> <span class="nb">iter</span> <span class="o">&gt;=</span> <span class="n">n_iter_max</span><span class="p">:</span>
            <span class="c1"># Set termination status</span>
            <span class="n">termination_status</span> <span class="o">=</span> \
                <span class="s1">&#39;Maximum number of pruning iterations reached.&#39;</span>
            <span class="c1"># Terminate pruning</span>
            <span class="n">is_keep_pruning</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Update pruning iteration counter</span>
            <span class="nb">iter</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="k">if</span> <span class="n">is_verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&gt; Termination status: </span><span class="si">{</span><span class="n">termination_status</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&gt; Pruning iterative loop finished successfully!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Add termination status to summary file</span>
    <span class="n">write_summary_file</span><span class="p">(</span><span class="n">pruning_dir</span><span class="p">,</span> <span class="n">pruning_params</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;end&#39;</span><span class="p">,</span>
                       <span class="n">mode_data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;termination_status&#39;</span><span class="p">:</span> <span class="n">termination_status</span><span class="p">})</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Build pruning data</span>
    <span class="n">pruning_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;pruning_params&#39;</span><span class="p">:</span> <span class="n">pruning_params</span><span class="p">,</span>
                    <span class="s1">&#39;pruning_iterative_data&#39;</span><span class="p">:</span> <span class="n">pruning_iterative_data</span><span class="p">}</span>
    <span class="c1"># Set pruning data file path</span>
    <span class="n">pruning_data_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">pruning_dir</span><span class="p">),</span>
                                          <span class="s1">&#39;pruning_data.pkl&#39;</span><span class="p">)</span>
    <span class="c1"># Save pruning data</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pruning_data_file_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pruning_file</span><span class="p">:</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pruning_data</span><span class="p">,</span> <span class="n">pruning_file</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="k">return</span> <span class="n">pruning_params</span><span class="p">,</span> <span class="n">pruning_iterative_data</span></div>
<span class="c1"># =============================================================================</span>
<div class="viewcode-block" id="setup_pruning_dirs"><a class="viewcode-back" href="../../../../_autosummary/hookeai.miscellaneous.pruning.pruning_dataset.setup_pruning_dirs.html#hookeai.miscellaneous.pruning.pruning_dataset.setup_pruning_dirs">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">setup_pruning_dirs</span><span class="p">(</span><span class="n">pruning_dir</span><span class="p">,</span> <span class="n">testing_types</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Setup main pruning process directories.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pruning_dir : str</span>
<span class="sd">        Pruning main directory.</span>
<span class="sd">    testing_types : tuple[str]</span>
<span class="sd">        Types of testing data sets used to assess the performance of the model</span>
<span class="sd">        trained on the pruned training data sets. Available testing types</span>
<span class="sd">        include: &#39;in_distribution&#39;, &#39;out_distribution&#39; and &#39;unused_data&#39;.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    base_datasets_dir : str</span>
<span class="sd">        Base data sets directory.</span>
<span class="sd">    prun_datasets_dir : str</span>
<span class="sd">        Pruned data sets directory.</span>
<span class="sd">    full_dataset_dir : str</span>
<span class="sd">        Full data set directory.</span>
<span class="sd">    test_dataset_dirs : dict</span>
<span class="sd">        Testing data set directory (item, str) for each testing type</span>
<span class="sd">        (key, str).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check pruning main directory</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">pruning_dir</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;The pruning main directory has not been found:&#39;</span>
                           <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">pruning_dir</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Set base data sets directory</span>
    <span class="n">base_datasets_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">pruning_dir</span><span class="p">),</span>
                                     <span class="s1">&#39;base_datasets&#39;</span><span class="p">)</span> 
    <span class="c1"># Check base data sets directory</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">base_datasets_dir</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;The base data sets directory has not been found:&#39;</span>
                           <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">base_datasets_dir</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Set full data set directory</span>
    <span class="n">full_dataset_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">base_datasets_dir</span><span class="p">),</span>
                                    <span class="s1">&#39;1_training_dataset&#39;</span><span class="p">)</span>
    <span class="c1"># Check full data set directory</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">full_dataset_dir</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;The full data set directory has not been found:&#39;</span>
                           <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">full_dataset_dir</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Initialize testing data sets directories</span>
    <span class="n">test_dataset_dirs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># Loop over testing types</span>
    <span class="k">for</span> <span class="n">testing_type</span> <span class="ow">in</span> <span class="n">testing_types</span><span class="p">:</span>
        <span class="c1"># Set testing data set directory</span>
        <span class="k">if</span> <span class="n">testing_type</span> <span class="o">==</span> <span class="s1">&#39;in_distribution&#39;</span><span class="p">:</span>
            <span class="n">test_dataset_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">base_datasets_dir</span><span class="p">),</span> <span class="s1">&#39;5_testing_id_dataset&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">testing_type</span> <span class="o">==</span> <span class="s1">&#39;out_distribution&#39;</span><span class="p">:</span>
            <span class="n">test_dataset_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">base_datasets_dir</span><span class="p">),</span> <span class="s1">&#39;6_testing_od_dataset&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">testing_type</span> <span class="o">==</span> <span class="s1">&#39;unused_data&#39;</span><span class="p">:</span>
            <span class="n">test_dataset_dir</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Unknown testing data set type.&#39;</span>
                               <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">Available testing types: </span><span class="si">{</span><span class="n">testing_types</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Check testing data set directory</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">test_dataset_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">test_dataset_dir</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;The </span><span class="si">{</span><span class="n">testing_type</span><span class="si">}</span><span class="s1"> testing data set directory has not been &#39;</span>
                <span class="sa">f</span><span class="s1">&#39;found:</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">test_dataset_dir</span><span class="p">)</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Store testing data set directory</span>
        <span class="n">test_dataset_dirs</span><span class="p">[</span><span class="n">testing_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_dataset_dir</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Set pruned data sets directory</span>
    <span class="n">prun_datasets_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">pruning_dir</span><span class="p">),</span>
                                     <span class="s1">&#39;pruned_datasets&#39;</span><span class="p">)</span>
    <span class="c1"># Create model predictions directory</span>
    <span class="n">make_directory</span><span class="p">(</span><span class="n">prun_datasets_dir</span><span class="p">,</span> <span class="n">is_overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Set pruning plots directory</span>
    <span class="n">prun_plots_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">pruning_dir</span><span class="p">),</span> <span class="s1">&#39;plots&#39;</span><span class="p">)</span>
    <span class="c1"># Create pruning plots directory</span>
    <span class="n">make_directory</span><span class="p">(</span><span class="n">prun_plots_dir</span><span class="p">,</span> <span class="n">is_overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="k">return</span> <span class="n">base_datasets_dir</span><span class="p">,</span> <span class="n">prun_datasets_dir</span><span class="p">,</span> <span class="n">full_dataset_dir</span><span class="p">,</span> \
        <span class="n">test_dataset_dirs</span></div>
<span class="c1"># =============================================================================</span>
<div class="viewcode-block" id="set_pruning_iter_dir"><a class="viewcode-back" href="../../../../_autosummary/hookeai.miscellaneous.pruning.pruning_dataset.set_pruning_iter_dir.html#hookeai.miscellaneous.pruning.pruning_dataset.set_pruning_iter_dir">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">set_pruning_iter_dir</span><span class="p">(</span><span class="n">prun_datasets_dir</span><span class="p">,</span> <span class="n">train_dataset</span><span class="p">,</span>
                         <span class="n">val_dataset</span><span class="p">,</span> <span class="n">unused_dataset</span><span class="p">,</span>
                         <span class="n">test_dataset_dirs</span><span class="o">=</span><span class="p">{},</span>
                         <span class="n">dataset_basename</span><span class="o">=</span><span class="s1">&#39;ss_paths_dataset&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Setup pruning iteration directory.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prun_datasets_dir : str</span>
<span class="sd">        Pruned data sets directory.</span>
<span class="sd">    train_dataset : torch.utils.data.Dataset</span>
<span class="sd">        Time series training data set. Each sample is stored as a dictionary</span>
<span class="sd">        where each feature (key, str) data is a torch.Tensor(2d) of shape</span>
<span class="sd">        (sequence_length, n_features).</span>
<span class="sd">    val_dataset : torch.utils.data.Dataset</span>
<span class="sd">        Time series validation data set. Each sample is stored as a dictionary</span>
<span class="sd">        where each feature (key, str) data is a torch.Tensor(2d) of shape</span>
<span class="sd">        (sequence_length, n_features).</span>
<span class="sd">    unused_dataset : torch.utils.data.Dataset</span>
<span class="sd">        Time series unused data set. Each sample is stored as a dictionary</span>
<span class="sd">        where each feature (key, str) data is a torch.Tensor(2d) of shape</span>
<span class="sd">        (sequence_length, n_features).</span>
<span class="sd">    test_dataset_dirs : dict, default={}</span>
<span class="sd">        Testing data set directory (item, str) for each testing type</span>
<span class="sd">        (key, str).</span>
<span class="sd">    dataset_basename : str, defaut=&#39;ss_paths_dataset&#39;</span>
<span class="sd">        Data set file base name.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pruning_iter_dir : str</span>
<span class="sd">        Pruning iteration directory.</span>
<span class="sd">    model_directory : str</span>
<span class="sd">        Directory where model is stored.</span>
<span class="sd">    train_dataset_file_path : str</span>
<span class="sd">        Training data set file path.</span>
<span class="sd">    val_dataset_file_path : str</span>
<span class="sd">        Validation data set file path.</span>
<span class="sd">    test_dataset_file_paths : dict</span>
<span class="sd">        Testing data set file path (item, str) for each testing type</span>
<span class="sd">        (key, str).</span>
<span class="sd">    test_prediction_dirs : dict</span>
<span class="sd">        Directory (item, str) where samples predictions results files are</span>
<span class="sd">        stored for each testing type (key, str).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set pruning iteration directory</span>
    <span class="n">pruning_iter_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">prun_datasets_dir</span><span class="p">),</span>
                                    <span class="sa">f</span><span class="s1">&#39;n</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Create pruning iteration directory</span>
    <span class="n">make_directory</span><span class="p">(</span><span class="n">pruning_iter_dir</span><span class="p">,</span> <span class="n">is_overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Set pruning training data set directory</span>
    <span class="n">train_dataset_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">pruning_iter_dir</span><span class="p">),</span>
                                     <span class="s1">&#39;1_training_dataset&#39;</span><span class="p">)</span> 
    <span class="c1"># Create pruning training data set directory</span>
    <span class="n">make_directory</span><span class="p">(</span><span class="n">train_dataset_dir</span><span class="p">,</span> <span class="n">is_overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Save pruning training data set</span>
    <span class="n">train_dataset_file_path</span> <span class="o">=</span> \
        <span class="n">save_dataset</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">dataset_basename</span><span class="p">,</span> <span class="n">train_dataset_dir</span><span class="p">,</span>
                     <span class="n">is_append_n_sample</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Set pruning validation data set directory</span>
    <span class="n">val_dataset_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">pruning_iter_dir</span><span class="p">),</span>
                                   <span class="s1">&#39;2_validation_dataset&#39;</span><span class="p">)</span> 
    <span class="c1"># Create pruning validation data set directory</span>
    <span class="n">make_directory</span><span class="p">(</span><span class="n">val_dataset_dir</span><span class="p">,</span> <span class="n">is_overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Save pruning validation data set</span>
    <span class="n">val_dataset_file_path</span> <span class="o">=</span> \
        <span class="n">save_dataset</span><span class="p">(</span><span class="n">val_dataset</span><span class="p">,</span> <span class="n">dataset_basename</span><span class="p">,</span> <span class="n">val_dataset_dir</span><span class="p">,</span>
                     <span class="n">is_append_n_sample</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Set model directory</span>
    <span class="n">model_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">pruning_iter_dir</span><span class="p">),</span>
                                   <span class="s1">&#39;3_model&#39;</span><span class="p">)</span>
    <span class="c1"># Create model directory</span>
    <span class="n">make_directory</span><span class="p">(</span><span class="n">model_directory</span><span class="p">,</span> <span class="n">is_overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Initialize testing data sets file paths</span>
    <span class="n">test_dataset_file_paths</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># Loop over testing data set directories</span>
    <span class="k">for</span> <span class="n">testing_type</span><span class="p">,</span> <span class="n">src_dataset_dir</span> <span class="ow">in</span> <span class="n">test_dataset_dirs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># Set testing data set file</span>
        <span class="k">if</span> <span class="n">testing_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;in_distribution&#39;</span><span class="p">,</span> <span class="s1">&#39;out_distribution&#39;</span><span class="p">):</span>
            <span class="c1"># Build pruning testing data set directory</span>
            <span class="n">dest_dataset_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">pruning_iter_dir</span><span class="p">),</span>
                                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">src_dataset_dir</span><span class="p">))</span>
            <span class="c1"># Copy pruning testing data set directory</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">src_dataset_dir</span><span class="p">,</span> <span class="n">dest_dataset_dir</span><span class="p">)</span>
            <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
            <span class="c1"># Get testing data set file path</span>
            <span class="n">regex</span> <span class="o">=</span> <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^&#39;</span> <span class="o">+</span> <span class="n">dataset_basename</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;_n[0-9]+.pkl$&#39;</span><span class="p">,)</span>
            <span class="n">is_file_found</span><span class="p">,</span> <span class="n">test_dataset_file_path</span> <span class="o">=</span> \
                <span class="n">find_unique_file_with_regex</span><span class="p">(</span><span class="n">dest_dataset_dir</span><span class="p">,</span> <span class="n">regex</span><span class="p">)</span>
            <span class="c1"># Check testing data set file</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_file_found</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Testing data set file has not been found &#39;</span>
                                   <span class="sa">f</span><span class="s1">&#39;in data set directory:</span><span class="se">\n\n</span><span class="s1">&#39;</span>
                                   <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">dest_dataset_dir</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
            <span class="c1"># Remove all content except testing data set file</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dest_dataset_dir</span><span class="p">):</span>
                <span class="c1"># Get item path</span>
                <span class="n">item_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest_dataset_dir</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="c1"># Remove item</span>
                <span class="k">if</span> <span class="n">item_path</span> <span class="o">!=</span> <span class="n">test_dataset_file_path</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">item_path</span><span class="p">):</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">item_path</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">item_path</span><span class="p">):</span>
                        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">item_path</span><span class="p">)</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="k">elif</span> <span class="n">testing_type</span> <span class="o">==</span> <span class="s1">&#39;unused_data&#39;</span><span class="p">:</span>
            <span class="c1"># Check unused data set</span>
            <span class="k">if</span> <span class="n">unused_dataset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;The unused data set must be provided to &#39;</span>
                                   <span class="s1">&#39;set the respective pruning iteration &#39;</span>
                                   <span class="s1">&#39;testing data set directory.&#39;</span><span class="p">)</span>
            <span class="c1"># Set pruning testing data set directory</span>
            <span class="n">test_dataset_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">pruning_iter_dir</span><span class="p">),</span>
                                            <span class="s1">&#39;8_testing_unused_dataset&#39;</span><span class="p">)</span> 
            <span class="c1"># Create pruning testing data set directory</span>
            <span class="n">make_directory</span><span class="p">(</span><span class="n">test_dataset_dir</span><span class="p">,</span> <span class="n">is_overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># Save pruning testing data set</span>
            <span class="n">test_dataset_file_path</span> <span class="o">=</span> \
                <span class="n">save_dataset</span><span class="p">(</span><span class="n">unused_dataset</span><span class="p">,</span> <span class="n">dataset_basename</span><span class="p">,</span>
                             <span class="n">test_dataset_dir</span><span class="p">,</span> <span class="n">is_append_n_sample</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Unknown handling of </span><span class="se">\&#39;</span><span class="si">{</span><span class="n">testing_type</span><span class="si">}</span><span class="se">\&#39;</span><span class="s1"> &#39;</span>
                               <span class="sa">f</span><span class="s1">&#39;testing data set directory.&#39;</span><span class="p">)</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Store testing data set file path</span>
        <span class="n">test_dataset_file_paths</span><span class="p">[</span><span class="n">testing_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_dataset_file_path</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Set pruning predictions directory</span>
    <span class="n">prediction_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">pruning_iter_dir</span><span class="p">),</span>
                                  <span class="s1">&#39;7_prediction&#39;</span><span class="p">)</span>
    <span class="c1"># Create pruning predictions directory</span>
    <span class="n">make_directory</span><span class="p">(</span><span class="n">prediction_dir</span><span class="p">,</span> <span class="n">is_overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Initialize testing prediction directories</span>
    <span class="n">test_prediction_dirs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># Loop over testing types</span>
    <span class="k">for</span> <span class="n">testing_type</span> <span class="ow">in</span> <span class="n">test_dataset_dirs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="c1"># Set testing predictions subdirectory</span>
        <span class="n">prediction_subdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">prediction_dir</span><span class="p">),</span> <span class="n">testing_type</span><span class="p">)</span>
        <span class="c1"># Create prediction subdirectory</span>
        <span class="n">make_directory</span><span class="p">(</span><span class="n">prediction_subdir</span><span class="p">,</span> <span class="n">is_overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Store testing predictions subdirectory</span>
        <span class="n">test_prediction_dirs</span><span class="p">[</span><span class="n">testing_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">prediction_subdir</span>  
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="k">return</span> <span class="n">pruning_iter_dir</span><span class="p">,</span> <span class="n">model_directory</span><span class="p">,</span> <span class="n">train_dataset_file_path</span><span class="p">,</span> \
        <span class="n">val_dataset_file_path</span><span class="p">,</span> <span class="n">test_dataset_file_paths</span><span class="p">,</span> <span class="n">test_prediction_dirs</span></div>
<span class="c1"># =============================================================================</span>
<div class="viewcode-block" id="set_default_pruning_parameters"><a class="viewcode-back" href="../../../../_autosummary/hookeai.miscellaneous.pruning.pruning_dataset.set_default_pruning_parameters.html#hookeai.miscellaneous.pruning.pruning_dataset.set_default_pruning_parameters">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">set_default_pruning_parameters</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set default pruning parameters.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pruning_params : dict</span>
<span class="sd">        Pruning parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set pruning scheduler</span>
    <span class="n">prun_scheduler_type</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="s1">&#39;proportional&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># Set pruning scheduler parameters</span>
    <span class="k">if</span> <span class="n">prun_scheduler_type</span> <span class="o">==</span> <span class="s1">&#39;proportional&#39;</span><span class="p">:</span>
        <span class="n">prun_scheduler_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;prun_ratio&#39;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">prun_scheduler_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n_prun_sample&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Set maximum number of pruning iterations</span>
    <span class="n">n_iter_max</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="c1"># Set minimum development data set size</span>
    <span class="n">n_dev_min</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="c1"># Set minimum development data set size ratio</span>
    <span class="n">ratio_dev_min</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="c1"># Set minimum pruning testing data set size</span>
    <span class="n">n_prun_test_min</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="c1"># Set maximum pruned samples testing ratio</span>
    <span class="n">prun_test_ratio_max</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="c1"># Set pruning step data sets split sizes</span>
    <span class="n">pruning_step_sizes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;training&#39;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span> <span class="s1">&#39;validation&#39;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;testing&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">}</span>
    <span class="c1"># Set pruning iteration data sets split sizes</span>
    <span class="n">pruning_iter_sizes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;training&#39;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span> <span class="s1">&#39;validation&#39;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">}</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Build pruning parameters</span>
    <span class="n">pruning_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n_iter_max&#39;</span><span class="p">:</span> <span class="n">n_iter_max</span><span class="p">,</span>
                      <span class="s1">&#39;prun_scheduler_type&#39;</span><span class="p">:</span> <span class="n">prun_scheduler_type</span><span class="p">,</span>
                      <span class="s1">&#39;prun_scheduler_params&#39;</span><span class="p">:</span> <span class="n">prun_scheduler_params</span><span class="p">,</span>
                      <span class="s1">&#39;n_dev_min&#39;</span><span class="p">:</span> <span class="n">n_dev_min</span><span class="p">,</span>
                      <span class="s1">&#39;ratio_dev_min&#39;</span><span class="p">:</span> <span class="n">ratio_dev_min</span><span class="p">,</span>
                      <span class="s1">&#39;n_prun_test_min&#39;</span><span class="p">:</span> <span class="n">n_prun_test_min</span><span class="p">,</span>
                      <span class="s1">&#39;prun_test_ratio_max&#39;</span><span class="p">:</span> <span class="n">prun_test_ratio_max</span><span class="p">,</span>
                      <span class="s1">&#39;pruning_step_sizes&#39;</span><span class="p">:</span> <span class="n">pruning_step_sizes</span><span class="p">,</span>
                      <span class="s1">&#39;pruning_iter_sizes&#39;</span><span class="p">:</span> <span class="n">pruning_iter_sizes</span><span class="p">}</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="k">return</span> <span class="n">pruning_params</span></div>
<span class="c1"># =============================================================================</span>
<div class="viewcode-block" id="get_n_prun_sample"><a class="viewcode-back" href="../../../../_autosummary/hookeai.miscellaneous.pruning.pruning_dataset.get_n_prun_sample.html#hookeai.miscellaneous.pruning.pruning_dataset.get_n_prun_sample">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_n_prun_sample</span><span class="p">(</span><span class="n">prun_scheduler_type</span><span class="p">,</span> <span class="n">prun_scheduler_params</span><span class="p">,</span> <span class="n">dev_dataset</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get number of pruned samples.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prun_scheduler_type : {&#39;constant&#39;, &#39;proportional&#39;}</span>
<span class="sd">        Pruning scheduler type defining the number of pruned samples in each</span>
<span class="sd">        pruning iteration. &#39;constant&#39; sets a constant number of pruned samples,</span>
<span class="sd">        while &#39;proportional&#39; sets the number of pruned samples as a ratio of</span>
<span class="sd">        the current development data set size.</span>
<span class="sd">    prun_scheduler_params : dict</span>
<span class="sd">        Pruning scheduler type parameters.</span>
<span class="sd">    dev_dataset : torch.utils.data.Dataset</span>
<span class="sd">        Time series development data set. Each sample is stored as a dictionary</span>
<span class="sd">        where each feature (key, str) data is a torch.Tensor(2d) of shape</span>
<span class="sd">        (sequence_length, n_features).</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    n_prun_sample : int</span>
<span class="sd">        Number of pruned samples.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get number of pruned samples</span>
    <span class="k">if</span> <span class="n">prun_scheduler_type</span> <span class="o">==</span> <span class="s1">&#39;constant&#39;</span><span class="p">:</span>
        <span class="c1"># Get number of pruned samples</span>
        <span class="n">n_prun_sample</span> <span class="o">=</span> <span class="n">prun_scheduler_params</span><span class="p">[</span><span class="s1">&#39;n_prun_sample&#39;</span><span class="p">]</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="k">elif</span> <span class="n">prun_scheduler_type</span> <span class="o">==</span> <span class="s1">&#39;proportional&#39;</span><span class="p">:</span>
        <span class="c1"># Get pruning ratio w.r.t. development data set size</span>
        <span class="n">prun_ratio</span> <span class="o">=</span> <span class="n">prun_scheduler_params</span><span class="p">[</span><span class="s1">&#39;prun_ratio&#39;</span><span class="p">]</span>
        <span class="c1"># Get development data set size</span>
        <span class="n">n_dev</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dev_dataset</span><span class="p">)</span>
        <span class="c1"># Get number of pruned samples</span>
        <span class="n">n_prun_sample</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">prun_ratio</span><span class="o">*</span><span class="n">n_dev</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Unknown pruning scheduler.&#39;</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="k">return</span> <span class="n">n_prun_sample</span></div>
<span class="c1"># =============================================================================</span>
<div class="viewcode-block" id="perform_pruning_step"><a class="viewcode-back" href="../../../../_autosummary/hookeai.miscellaneous.pruning.pruning_dataset.perform_pruning_step.html#hookeai.miscellaneous.pruning.pruning_dataset.perform_pruning_step">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">perform_pruning_step</span><span class="p">(</span><span class="n">prun_datasets_dir</span><span class="p">,</span> <span class="n">pruning_params</span><span class="p">,</span> <span class="n">dev_dataset</span><span class="p">,</span>
                         <span class="n">unused_dataset</span><span class="p">,</span> <span class="n">device_type</span><span class="o">=</span><span class="s1">&#39;cpu&#39;</span><span class="p">,</span> <span class="n">is_verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform pruning step.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prun_datasets_dir : str</span>
<span class="sd">        Pruned data sets directory.</span>
<span class="sd">    pruning_params : dict</span>
<span class="sd">        Pruning parameters.</span>
<span class="sd">    dev_dataset : torch.utils.data.Dataset</span>
<span class="sd">        Time series development data set. Each sample is stored as a dictionary</span>
<span class="sd">        where each feature (key, str) data is a torch.Tensor(2d) of shape</span>
<span class="sd">        (sequence_length, n_features).</span>
<span class="sd">    unused_dataset : torch.utils.data.Dataset</span>
<span class="sd">        Time series unused data set. Each sample is stored as a dictionary</span>
<span class="sd">        where each feature (key, str) data is a torch.Tensor(2d) of shape</span>
<span class="sd">        (sequence_length, n_features).</span>
<span class="sd">    device_type : {&#39;cpu&#39;, &#39;cuda&#39;}, default=&#39;cpu&#39;</span>
<span class="sd">        Type of device on which torch.Tensor is allocated.</span>
<span class="sd">    is_verbose : bool, default=False</span>
<span class="sd">        If True, enable verbose output.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    is_valid_pruning_step : bool</span>
<span class="sd">        If True, then pruning step is admissible and is performed. If False,</span>
<span class="sd">        then pruning step is non-admissible and data sets are unchanged.</span>
<span class="sd">    step_status : str</span>
<span class="sd">        Pruning step status.</span>
<span class="sd">    dev_dataset : torch.utils.data.Dataset</span>
<span class="sd">        Time series development data set. Each sample is stored as a dictionary</span>
<span class="sd">        where each feature (key, str) data is a torch.Tensor(2d) of shape</span>
<span class="sd">        (sequence_length, n_features).</span>
<span class="sd">    unused_dataset : torch.utils.data.Dataset</span>
<span class="sd">        Time series unused data set. Each sample is stored as a dictionary</span>
<span class="sd">        where each feature (key, str) data is a torch.Tensor(2d) of shape</span>
<span class="sd">        (sequence_length, n_features).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get full data set size</span>
    <span class="n">n_full</span> <span class="o">=</span> <span class="n">pruning_params</span><span class="p">[</span><span class="s1">&#39;n_full&#39;</span><span class="p">]</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Get pruning scheduler type</span>
    <span class="n">prun_scheduler_type</span> <span class="o">=</span> <span class="n">pruning_params</span><span class="p">[</span><span class="s1">&#39;prun_scheduler_type&#39;</span><span class="p">]</span>
    <span class="c1"># Get pruning scheduler type parameters</span>
    <span class="n">prun_scheduler_params</span> <span class="o">=</span> <span class="n">pruning_params</span><span class="p">[</span><span class="s1">&#39;prun_scheduler_params&#39;</span><span class="p">]</span>
    <span class="c1"># Get number of pruned samples</span>
    <span class="n">n_prun_sample</span> <span class="o">=</span> <span class="n">get_n_prun_sample</span><span class="p">(</span>
        <span class="n">prun_scheduler_type</span><span class="p">,</span> <span class="n">prun_scheduler_params</span><span class="p">,</span> <span class="n">dev_dataset</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Get minimum development data set size</span>
    <span class="n">n_dev_min</span> <span class="o">=</span> <span class="n">pruning_params</span><span class="p">[</span><span class="s1">&#39;n_dev_min&#39;</span><span class="p">]</span>
    <span class="c1"># Get minimum development data set size ratio</span>
    <span class="n">ratio_dev_min</span> <span class="o">=</span> <span class="n">pruning_params</span><span class="p">[</span><span class="s1">&#39;ratio_dev_min&#39;</span><span class="p">]</span>
    <span class="c1"># Get minimum pruning testing data set size</span>
    <span class="n">n_prun_test_min</span> <span class="o">=</span> <span class="n">pruning_params</span><span class="p">[</span><span class="s1">&#39;n_prun_test_min&#39;</span><span class="p">]</span>
    <span class="c1"># Get maximum pruned samples testing ratio</span>
    <span class="n">prun_test_ratio_max</span> <span class="o">=</span> <span class="n">pruning_params</span><span class="p">[</span><span class="s1">&#39;prun_test_ratio_max&#39;</span><span class="p">]</span>
    <span class="c1"># Get pruning step data set split sizes</span>
    <span class="n">pruning_step_sizes</span> <span class="o">=</span> <span class="n">pruning_params</span><span class="p">[</span><span class="s1">&#39;pruning_step_sizes&#39;</span><span class="p">]</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Get development data set size</span>
    <span class="n">n_dev</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dev_dataset</span><span class="p">)</span>
    <span class="c1"># Randomly split development data set</span>
    <span class="n">dev_dataset_split</span> <span class="o">=</span> <span class="n">split_dataset</span><span class="p">(</span><span class="n">dev_dataset</span><span class="p">,</span> <span class="n">pruning_step_sizes</span><span class="p">)</span>
    <span class="c1"># Get pruning step data sets</span>
    <span class="n">train_dataset</span> <span class="o">=</span> <span class="n">dev_dataset_split</span><span class="p">[</span><span class="s1">&#39;training&#39;</span><span class="p">]</span>
    <span class="n">val_dataset</span> <span class="o">=</span> <span class="n">dev_dataset_split</span><span class="p">[</span><span class="s1">&#39;validation&#39;</span><span class="p">]</span>
    <span class="n">test_dataset</span> <span class="o">=</span> <span class="n">dev_dataset_split</span><span class="p">[</span><span class="s1">&#39;testing&#39;</span><span class="p">]</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Initialize pruning step status</span>
    <span class="n">step_status</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># Check pruning step admissibility</span>
    <span class="k">if</span> <span class="n">n_dev</span> <span class="o">&lt;=</span> <span class="n">n_dev_min</span><span class="p">:</span>
        <span class="n">step_status</span> <span class="o">=</span> <span class="s1">&#39;Minimum development data set size reached.&#39;</span>
    <span class="k">elif</span> <span class="n">n_dev</span><span class="o">/</span><span class="n">n_full</span> <span class="o">&lt;</span> <span class="n">ratio_dev_min</span><span class="p">:</span>
        <span class="n">step_status</span> <span class="o">=</span> <span class="s1">&#39;Minimum pruning testing data set size ratio reached.&#39;</span>
    <span class="k">elif</span> <span class="n">n_dev</span> <span class="o">&lt;</span> <span class="n">n_prun_test_min</span><span class="p">:</span>
        <span class="n">step_status</span> <span class="o">=</span> <span class="s1">&#39;Minimum pruning testing data set size reached.&#39;</span>
    <span class="k">elif</span> <span class="n">n_prun_sample</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">prun_test_ratio_max</span><span class="p">:</span>
        <span class="n">step_status</span> <span class="o">=</span> <span class="s1">&#39;Maximum pruned samples testing ratio reached.&#39;</span>
    <span class="c1"># Set pruning step admissibility</span>
    <span class="k">if</span> <span class="n">step_status</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">is_valid_pruning_step</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">is_valid_pruning_step</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Perform pruning step</span>
    <span class="k">if</span> <span class="n">is_valid_pruning_step</span><span class="p">:</span>
        <span class="c1"># Set pruning step directory</span>
        <span class="n">pruning_step_dir</span><span class="p">,</span> <span class="n">model_directory</span><span class="p">,</span> <span class="n">train_dataset_file_path</span><span class="p">,</span> \
            <span class="n">val_dataset_file_path</span><span class="p">,</span> <span class="n">test_dataset_file_path</span><span class="p">,</span> \
                    <span class="n">prediction_subdir</span> <span class="o">=</span> <span class="n">set_pruning_step_dir</span><span class="p">(</span>
                        <span class="n">prun_datasets_dir</span><span class="p">,</span> <span class="n">train_dataset</span><span class="p">,</span> <span class="n">val_dataset</span><span class="p">,</span>
                        <span class="n">test_dataset</span><span class="p">)</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Perform pruning step model standard training</span>
        <span class="n">perform_model_standard_training</span><span class="p">(</span>
            <span class="n">train_dataset_file_path</span><span class="p">,</span> <span class="n">model_directory</span><span class="p">,</span>
            <span class="n">val_dataset_file_path</span><span class="o">=</span><span class="n">val_dataset_file_path</span><span class="p">,</span>
            <span class="n">device_type</span><span class="o">=</span><span class="n">device_type</span><span class="p">,</span> <span class="n">is_verbose</span><span class="o">=</span><span class="n">is_verbose</span><span class="p">)</span>
        <span class="c1"># Perform pruning step model prediction</span>
        <span class="n">predict_subdir</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">perform_model_prediction</span><span class="p">(</span>
            <span class="n">prediction_subdir</span><span class="p">,</span> <span class="n">test_dataset_file_path</span><span class="p">,</span> <span class="n">model_directory</span><span class="p">,</span>
            <span class="n">device_type</span><span class="o">=</span><span class="n">device_type</span><span class="p">,</span> <span class="n">is_verbose</span><span class="o">=</span><span class="n">is_verbose</span><span class="p">)</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Collect samples prediction loss</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">samples_loss</span> <span class="o">=</span> <span class="n">read_samples_loss_from_dir</span><span class="p">(</span><span class="n">predict_subdir</span><span class="p">)</span>
        <span class="c1"># Get sorted indices based on samples prediction loss</span>
        <span class="n">sorted_indices</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">samples_loss</span><span class="p">)),</span>
                                <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">samples_loss</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="c1"># Extract pruned samples testing indices</span>
        <span class="n">prune_samples_test_indices</span> <span class="o">=</span> <span class="n">sorted_indices</span><span class="p">[:</span><span class="n">n_prun_sample</span><span class="p">]</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Get pruned samples development indices</span>
        <span class="n">prune_samples_dev_indices</span> <span class="o">=</span> <span class="n">get_parent_dataset_indices</span><span class="p">(</span>
            <span class="n">test_dataset</span><span class="p">,</span> <span class="n">prune_samples_test_indices</span><span class="p">)</span>
        <span class="c1"># Get pruned samples data</span>
        <span class="n">prune_samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">dev_dataset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">prune_samples_dev_indices</span><span class="p">]</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Prune development data set</span>
        <span class="n">dev_dataset</span><span class="o">.</span><span class="n">remove_dataset_samples</span><span class="p">(</span><span class="n">prune_samples_dev_indices</span><span class="p">)</span>
        <span class="c1"># Update unused data set</span>
        <span class="n">unused_dataset</span><span class="o">.</span><span class="n">add_dataset_samples</span><span class="p">(</span><span class="n">prune_samples</span><span class="p">)</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Remove pruning step directory</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">pruning_step_dir</span><span class="p">)</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Set step status</span>
        <span class="n">step_status</span> <span class="o">=</span> <span class="s1">&#39;Pruning step performed successfully.&#39;</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="k">return</span> <span class="n">is_valid_pruning_step</span><span class="p">,</span> <span class="n">step_status</span><span class="p">,</span> <span class="n">dev_dataset</span><span class="p">,</span> <span class="n">unused_dataset</span></div>
<span class="c1"># =============================================================================</span>
<div class="viewcode-block" id="set_pruning_step_dir"><a class="viewcode-back" href="../../../../_autosummary/hookeai.miscellaneous.pruning.pruning_dataset.set_pruning_step_dir.html#hookeai.miscellaneous.pruning.pruning_dataset.set_pruning_step_dir">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">set_pruning_step_dir</span><span class="p">(</span><span class="n">prun_datasets_dir</span><span class="p">,</span> <span class="n">train_dataset</span><span class="p">,</span> <span class="n">val_dataset</span><span class="p">,</span>
                         <span class="n">test_dataset</span><span class="p">,</span> <span class="n">dataset_basename</span><span class="o">=</span><span class="s1">&#39;ss_paths_dataset&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Setup pruning iteration directory.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prun_datasets_dir : str</span>
<span class="sd">        Pruned data sets directory.</span>
<span class="sd">    train_dataset : torch.utils.data.Dataset</span>
<span class="sd">        Time series training data set. Each sample is stored as a dictionary</span>
<span class="sd">        where each feature (key, str) data is a torch.Tensor(2d) of shape</span>
<span class="sd">        (sequence_length, n_features).</span>
<span class="sd">    val_dataset : torch.utils.data.Dataset</span>
<span class="sd">        Time series validation data set. Each sample is stored as a dictionary</span>
<span class="sd">        where each feature (key, str) data is a torch.Tensor(2d) of shape</span>
<span class="sd">        (sequence_length, n_features).</span>
<span class="sd">    test_dataset : torch.utils.data.Dataset</span>
<span class="sd">        Time series testing data set. Each sample is stored as a dictionary</span>
<span class="sd">        where each feature (key, str) data is a torch.Tensor(2d) of shape</span>
<span class="sd">        (sequence_length, n_features).</span>
<span class="sd">    dataset_basename : str, defaut=&#39;ss_paths_dataset&#39;</span>
<span class="sd">        Data set file base name.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pruning_step_dir : str</span>
<span class="sd">        Pruning step directory.</span>
<span class="sd">    model_directory : str</span>
<span class="sd">        Directory where model is stored.</span>
<span class="sd">    train_dataset_file_path : str</span>
<span class="sd">        Training data set file path.</span>
<span class="sd">    val_dataset_file_path : str</span>
<span class="sd">        Validation data set file path.</span>
<span class="sd">    test_dataset_file_path : str</span>
<span class="sd">        Testing data set file path.</span>
<span class="sd">    prediction_subdir : str</span>
<span class="sd">        Directory where samples predictions results files are stored.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set pruning step directory</span>
    <span class="n">pruning_step_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">prun_datasets_dir</span><span class="p">),</span>
                                    <span class="sa">f</span><span class="s1">&#39;pruning_step&#39;</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Create pruning step directory</span>
    <span class="n">make_directory</span><span class="p">(</span><span class="n">pruning_step_dir</span><span class="p">,</span> <span class="n">is_overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Set pruning training data set directory</span>
    <span class="n">train_dataset_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">pruning_step_dir</span><span class="p">),</span>
                                     <span class="s1">&#39;1_training_dataset&#39;</span><span class="p">)</span> 
    <span class="c1"># Create pruning training data set directory</span>
    <span class="n">make_directory</span><span class="p">(</span><span class="n">train_dataset_dir</span><span class="p">,</span> <span class="n">is_overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Save pruning training data set</span>
    <span class="n">train_dataset_file_path</span> <span class="o">=</span> \
        <span class="n">save_dataset</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">dataset_basename</span><span class="p">,</span> <span class="n">train_dataset_dir</span><span class="p">,</span>
                     <span class="n">is_append_n_sample</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Set pruning validation data set directory</span>
    <span class="n">val_dataset_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">pruning_step_dir</span><span class="p">),</span>
                                   <span class="s1">&#39;2_validation_dataset&#39;</span><span class="p">)</span> 
    <span class="c1"># Create pruning validation data set directory</span>
    <span class="n">make_directory</span><span class="p">(</span><span class="n">val_dataset_dir</span><span class="p">,</span> <span class="n">is_overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Save pruning validation data set</span>
    <span class="n">val_dataset_file_path</span> <span class="o">=</span> \
        <span class="n">save_dataset</span><span class="p">(</span><span class="n">val_dataset</span><span class="p">,</span> <span class="n">dataset_basename</span><span class="p">,</span> <span class="n">val_dataset_dir</span><span class="p">,</span>
                     <span class="n">is_append_n_sample</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Set model directory</span>
    <span class="n">model_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">pruning_step_dir</span><span class="p">),</span>
                                   <span class="s1">&#39;3_model&#39;</span><span class="p">)</span>
    <span class="c1"># Create model directory</span>
    <span class="n">make_directory</span><span class="p">(</span><span class="n">model_directory</span><span class="p">,</span> <span class="n">is_overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Set pruning testing data set directory</span>
    <span class="n">test_dataset_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">pruning_step_dir</span><span class="p">),</span>
                                    <span class="s1">&#39;5_testing_id_dataset&#39;</span><span class="p">)</span> 
    <span class="c1"># Create pruning testing data set directory</span>
    <span class="n">make_directory</span><span class="p">(</span><span class="n">test_dataset_dir</span><span class="p">,</span> <span class="n">is_overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Save pruning testing data set</span>
    <span class="n">test_dataset_file_path</span> <span class="o">=</span> \
        <span class="n">save_dataset</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">,</span> <span class="n">dataset_basename</span><span class="p">,</span> <span class="n">val_dataset_dir</span><span class="p">,</span>
                     <span class="n">is_append_n_sample</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Set pruning predictions directory</span>
    <span class="n">prediction_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">pruning_step_dir</span><span class="p">),</span>
                                        <span class="s1">&#39;7_prediction&#39;</span><span class="p">)</span>
    <span class="c1"># Create pruning predictions directory</span>
    <span class="n">make_directory</span><span class="p">(</span><span class="n">prediction_dir</span><span class="p">,</span> <span class="n">is_overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Create pruning predictions subdirectory</span>
    <span class="n">prediction_subdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">prediction_dir</span><span class="p">),</span> <span class="s1">&#39;in_distribution&#39;</span><span class="p">)</span>
    <span class="c1"># Create prediction subdirectory</span>
    <span class="n">make_directory</span><span class="p">(</span><span class="n">prediction_subdir</span><span class="p">,</span> <span class="n">is_overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="k">return</span> <span class="n">pruning_step_dir</span><span class="p">,</span> <span class="n">model_directory</span><span class="p">,</span> <span class="n">train_dataset_file_path</span><span class="p">,</span> \
        <span class="n">val_dataset_file_path</span><span class="p">,</span> <span class="n">test_dataset_file_path</span><span class="p">,</span> <span class="n">prediction_subdir</span></div>
<span class="c1"># =============================================================================</span>
<div class="viewcode-block" id="write_summary_file"><a class="viewcode-back" href="../../../../_autosummary/hookeai.miscellaneous.pruning.pruning_dataset.write_summary_file.html#hookeai.miscellaneous.pruning.pruning_dataset.write_summary_file">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">write_summary_file</span><span class="p">(</span><span class="n">pruning_dir</span><span class="p">,</span> <span class="n">pruning_params</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;init&#39;</span><span class="p">,</span> <span class="n">mode_data</span><span class="o">=</span><span class="p">{}):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write summary file.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pruning_dir : str</span>
<span class="sd">        Pruning main directory.</span>
<span class="sd">    pruning_params : dict</span>
<span class="sd">        Pruning parameters.</span>
<span class="sd">    mode : {&#39;init&#39;, &#39;iter&#39;, &#39;end&#39;}, default=&#39;init&#39;</span>
<span class="sd">        Summary mode.</span>
<span class="sd">    mode_data : dict, default={}</span>
<span class="sd">        Summary mode data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set summary file path</span>
    <span class="n">summary_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">pruning_dir</span><span class="p">),</span>
                                     <span class="s1">&#39;summary.dat&#39;</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Initialize summary content</span>
    <span class="n">summary</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;init&#39;</span><span class="p">:</span>
        <span class="c1"># Set summary file header</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;Summary - Data set pruning process&#39;</span>
        <span class="n">sep</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="o">*</span><span class="s1">&#39;-&#39;</span>
        <span class="n">summary</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">sep</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,]</span>
        <span class="c1"># Assemble full data set size</span>
        <span class="n">n_full</span> <span class="o">=</span> <span class="n">pruning_params</span><span class="p">[</span><span class="s1">&#39;n_full&#39;</span><span class="p">]</span>
        <span class="n">summary</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&gt; Full data set size: </span><span class="si">{</span><span class="n">n_full</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,]</span>
        <span class="c1"># Assemble pruning parameters</span>
        <span class="n">n_iter_max</span> <span class="o">=</span> <span class="n">pruning_params</span><span class="p">[</span><span class="s1">&#39;n_iter_max&#39;</span><span class="p">]</span>
        <span class="n">summary</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&gt; Maximum number of pruning iterations: &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">n_iter_max</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,]</span>
        <span class="n">n_dev_min</span> <span class="o">=</span> <span class="n">pruning_params</span><span class="p">[</span><span class="s1">&#39;n_dev_min&#39;</span><span class="p">]</span>
        <span class="n">summary</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&gt; Minimum development data set size: &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">n_dev_min</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,]</span>
        <span class="n">ratio_dev_min</span> <span class="o">=</span> <span class="n">pruning_params</span><span class="p">[</span><span class="s1">&#39;ratio_dev_min&#39;</span><span class="p">]</span>
        <span class="n">summary</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&gt; Minimum development data set size ratio: &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ratio_dev_min</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,]</span>
        <span class="n">n_prun_test_min</span> <span class="o">=</span> <span class="n">pruning_params</span><span class="p">[</span><span class="s1">&#39;n_prun_test_min&#39;</span><span class="p">]</span>
        <span class="n">summary</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&gt; Minimum pruning testing data set size: &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">n_prun_test_min</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,]</span>
        <span class="n">prun_test_ratio_max</span> <span class="o">=</span> <span class="n">pruning_params</span><span class="p">[</span><span class="s1">&#39;prun_test_ratio_max&#39;</span><span class="p">]</span>
        <span class="n">summary</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&gt; Maximum pruned samples testing ratio: &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">prun_test_ratio_max</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,]</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Assemble pruning iterations header</span>
        <span class="n">summary</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&gt; Data set pruning iterations:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,]</span>
        <span class="n">size_sep</span> <span class="o">=</span> <span class="mi">59</span><span class="o">*</span><span class="s1">&#39;-&#39;</span>
        <span class="n">perf_sep</span> <span class="o">=</span> <span class="mi">35</span><span class="o">*</span><span class="s1">&#39;-&#39;</span>
        <span class="n">summary</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="s2">&quot;Data sets&quot;</span><span class="si">:</span><span class="s1">&gt;44s</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="s2">&quot;Testing performance&quot;</span><span class="si">:</span><span class="s1">&gt;60s</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="n">size_sep</span><span class="si">:</span><span class="s1">&gt;71s</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">perf_sep</span><span class="si">:</span><span class="s1">&gt;41s</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="s2">&quot;iter&quot;</span><span class="si">:</span><span class="s1">&gt;6s</span><span class="si">}</span><span class="s1"> &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot;dev&quot;</span><span class="si">:</span><span class="s1">&gt;8s</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2">ull&quot;</span><span class="si">:</span><span class="s1">&gt;6s</span><span class="si">}</span><span class="s1"> &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot;train&quot;</span><span class="si">:</span><span class="s1">&gt;8s</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2">ull&quot;</span><span class="si">:</span><span class="s1">&gt;6s</span><span class="si">}</span><span class="s1"> &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot;valid&quot;</span><span class="si">:</span><span class="s1">&gt;8s</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2">ull&quot;</span><span class="si">:</span><span class="s1">&gt;6s</span><span class="si">}</span><span class="s1"> &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot;unused&quot;</span><span class="si">:</span><span class="s1">&gt;9s</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2">ull&quot;</span><span class="si">:</span><span class="s1">&gt;6s</span><span class="si">}</span><span class="s1"> &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot;in_dist&quot;</span><span class="si">:</span><span class="s1">&gt;13s</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="s2">&quot;out_dist&quot;</span><span class="si">:</span><span class="s1">&gt;13s</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="s2">&quot;unused&quot;</span><span class="si">:</span><span class="s1">&gt;13s</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Write summary file</span>
        <span class="nb">open</span><span class="p">(</span><span class="n">summary_file_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;iter&#39;</span><span class="p">:</span>
        <span class="c1"># Get full data set size</span>
        <span class="n">n_full</span> <span class="o">=</span> <span class="n">mode_data</span><span class="p">[</span><span class="s1">&#39;n_full&#39;</span><span class="p">]</span>
        <span class="c1"># Gather iteration</span>
        <span class="nb">iter</span> <span class="o">=</span> <span class="n">mode_data</span><span class="p">[</span><span class="s1">&#39;iter&#39;</span><span class="p">]</span>
        <span class="c1"># Gather iteration data sets data</span>
        <span class="n">n_dev</span> <span class="o">=</span> <span class="n">mode_data</span><span class="p">[</span><span class="s1">&#39;n_dev&#39;</span><span class="p">]</span>
        <span class="n">ratio_dev_pc</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_dev</span><span class="o">/</span><span class="n">n_full</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
        <span class="n">n_train</span> <span class="o">=</span> <span class="n">mode_data</span><span class="p">[</span><span class="s1">&#39;n_train&#39;</span><span class="p">]</span>
        <span class="n">ratio_train_pc</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_train</span><span class="o">/</span><span class="n">n_full</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
        <span class="n">n_valid</span> <span class="o">=</span> <span class="n">mode_data</span><span class="p">[</span><span class="s1">&#39;n_valid&#39;</span><span class="p">]</span>
        <span class="n">ratio_valid_pc</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_valid</span><span class="o">/</span><span class="n">n_full</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
        <span class="n">n_unused</span> <span class="o">=</span> <span class="n">mode_data</span><span class="p">[</span><span class="s1">&#39;n_unused&#39;</span><span class="p">]</span>
        <span class="n">ratio_unused_pc</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_unused</span><span class="o">/</span><span class="n">n_full</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
        <span class="c1"># Gather iteration testing performance data</span>
        <span class="n">testing_types_loss</span> <span class="o">=</span> <span class="n">mode_data</span><span class="p">[</span><span class="s1">&#39;testing_types_loss&#39;</span><span class="p">]</span>
        <span class="n">testing_losses</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">testing_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;in_distribution&#39;</span><span class="p">,</span> <span class="s1">&#39;out_distribution&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;unused_data&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">testing_type</span> <span class="ow">in</span> <span class="n">testing_types_loss</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">testing_losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">testing_types_loss</span><span class="p">[</span><span class="n">testing_type</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">testing_losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="c1"># Format iteration testing performance data</span>
        <span class="n">testing_losses</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">&gt;13.4e</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot;&quot;</span><span class="si">:</span><span class="s1">&gt;13s</span><span class="si">}</span><span class="s1">&#39;</span>
                          <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">testing_losses</span><span class="p">]</span>
        <span class="c1"># Assemble iteration data</span>
        <span class="n">summary</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">iter</span><span class="si">:</span><span class="s1">&gt;6d</span><span class="si">}</span><span class="s1"> &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">n_dev</span><span class="si">:</span><span class="s1">&gt;8d</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">ratio_dev_pc</span><span class="si">:</span><span class="s1">&gt;6.1f</span><span class="si">}</span><span class="s1"> &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">n_train</span><span class="si">:</span><span class="s1">&gt;8d</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">ratio_train_pc</span><span class="si">:</span><span class="s1">&gt;6.1f</span><span class="si">}</span><span class="s1"> &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">n_valid</span><span class="si">:</span><span class="s1">&gt;8d</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">ratio_valid_pc</span><span class="si">:</span><span class="s1">&gt;6.1f</span><span class="si">}</span><span class="s1"> &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">n_unused</span><span class="si">:</span><span class="s1">&gt;9d</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">ratio_unused_pc</span><span class="si">:</span><span class="s1">&gt;6.1f</span><span class="si">}</span><span class="s1"> &#39;</span><span class="p">,</span>
                    <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">testing_losses</span><span class="p">),</span>
                    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Write summary file</span>
        <span class="nb">open</span><span class="p">(</span><span class="n">summary_file_path</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;end&#39;</span><span class="p">:</span>
        <span class="c1"># Get termination status</span>
        <span class="n">termination_status</span> <span class="o">=</span> <span class="n">mode_data</span><span class="p">[</span><span class="s1">&#39;termination_status&#39;</span><span class="p">]</span>
        <span class="c1"># Assemble termination status</span>
        <span class="n">summary</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&gt; Termination status: </span><span class="si">{</span><span class="n">termination_status</span><span class="si">}</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">,]</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Write summary file</span>
        <span class="nb">open</span><span class="p">(</span><span class="n">summary_file_path</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Unknown summary mode.&#39;</span><span class="p">)</span></div>
<span class="c1"># =============================================================================</span>
<div class="viewcode-block" id="load_full_dataset"><a class="viewcode-back" href="../../../../_autosummary/hookeai.miscellaneous.pruning.pruning_dataset.load_full_dataset.html#hookeai.miscellaneous.pruning.pruning_dataset.load_full_dataset">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">load_full_dataset</span><span class="p">(</span><span class="n">full_dataset_dir</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load full data set.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    full_dataset_dir : str</span>
<span class="sd">        Full data set directory.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dataset : torch.utils.data.Dataset</span>
<span class="sd">        Time series data set. Each sample is stored as a dictionary where</span>
<span class="sd">        each feature (key, str) data is a torch.Tensor(2d) of shape</span>
<span class="sd">        (sequence_length, n_features).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get data set file path</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^ss_paths_dataset_n[0-9]+.pkl$&#39;</span><span class="p">,)</span>
    <span class="n">is_file_found</span><span class="p">,</span> <span class="n">full_dataset_file_path</span> <span class="o">=</span> \
        <span class="n">find_unique_file_with_regex</span><span class="p">(</span><span class="n">full_dataset_dir</span><span class="p">,</span> <span class="n">regex</span><span class="p">)</span>
    <span class="c1"># Check data set file</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_file_found</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Full data set file has not been found &#39;</span>
                           <span class="sa">f</span><span class="s1">&#39;in data set directory:</span><span class="se">\n\n</span><span class="s1">&#39;</span>
                           <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">full_dataset_dir</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Load data set</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="n">full_dataset_file_path</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="k">return</span> <span class="n">dataset</span></div>
<span class="c1"># =============================================================================</span>
<div class="viewcode-block" id="read_samples_loss_from_dir"><a class="viewcode-back" href="../../../../_autosummary/hookeai.miscellaneous.pruning.pruning_dataset.read_samples_loss_from_dir.html#hookeai.miscellaneous.pruning.pruning_dataset.read_samples_loss_from_dir">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">read_samples_loss_from_dir</span><span class="p">(</span><span class="n">predictions_dir</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read loss samples from prediction directory.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    predictions_dir : str</span>
<span class="sd">        Directory where samples predictions results files are stored.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    samples_id : list[int]</span>
<span class="sd">        Samples IDs.</span>
<span class="sd">    samples_loss : list[float]</span>
<span class="sd">        Samples prediction loss.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check sample predictions directory</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">predictions_dir</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;The samples predictions directory has not been &#39;</span>
                           <span class="s1">&#39;found:</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">predictions_dir</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Get files in samples predictions results directory</span>
    <span class="n">directory_list</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">predictions_dir</span><span class="p">)</span>
    <span class="c1"># Check directory</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">directory_list</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;No files have been found in directory where &#39;</span>
                           <span class="s1">&#39;samples predictions results files are stored.&#39;</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Initialize samples predictions files</span>
    <span class="n">prediction_files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">prediction_files_id</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Get samples prediction files</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">directory_list</span><span class="p">:</span>
        <span class="c1"># Check if file is sample prediction file</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^prediction_sample_([0-9]+).pkl$&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="c1"># Store sample prediction file and ID</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Store sample file path</span>
            <span class="n">prediction_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">predictions_dir</span><span class="p">),</span> <span class="n">filename</span><span class="p">))</span>
            <span class="c1"># Store sample ID</span>
            <span class="n">prediction_files_id</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">id</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Check prediction files</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">prediction_files</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;No sample results files have been found in &#39;</span>
                           <span class="s1">&#39;directory where samples predictions results files &#39;</span>
                           <span class="s1">&#39;are stored.&#39;</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Get sorted indices based on samples prediction files</span>
    <span class="n">sorted_indices</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
        <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prediction_files</span><span class="p">)),</span>
        <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d+)\D*$&#39;</span><span class="p">,</span>
                                    <span class="n">prediction_files</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="c1"># Sort samples prediction files</span>
    <span class="n">prediction_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">prediction_files</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sorted_indices</span><span class="p">]</span>
    <span class="n">prediction_files_id</span> <span class="o">=</span> <span class="p">[</span><span class="n">prediction_files_id</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sorted_indices</span><span class="p">]</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Set samples IDs</span>
    <span class="n">samples_id</span> <span class="o">=</span> <span class="n">prediction_files_id</span>
    <span class="c1"># Initialize samples prediction loss</span>
    <span class="n">samples_loss</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Loop over samples prediction files</span>
    <span class="k">for</span> <span class="n">sample_file_path</span> <span class="ow">in</span> <span class="n">prediction_files</span><span class="p">:</span>
        <span class="c1"># Load sample predictions results</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">sample_file_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">sample_file</span><span class="p">:</span>
            <span class="n">sample_results</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">sample_file</span><span class="p">)</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Get sample prediction loss</span>
        <span class="k">if</span> <span class="s1">&#39;prediction_loss_data&#39;</span> <span class="ow">in</span> <span class="n">sample_results</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># Get sample prediction loss data</span>
            <span class="n">prediction_loss_data</span> <span class="o">=</span> <span class="n">sample_results</span><span class="p">[</span><span class="s1">&#39;prediction_loss_data&#39;</span><span class="p">]</span>
            <span class="c1"># Gather sample prediction loss</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">prediction_loss_data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="c1"># Store sample prediction loss</span>
            <span class="n">samples_loss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Sample prediction loss data is not available &#39;</span>
                               <span class="sa">f</span><span class="s1">&#39;in sample prediction file:</span><span class="se">\n\n</span><span class="s1">&#39;</span>
                               <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">sample_file_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="k">return</span> <span class="n">samples_id</span><span class="p">,</span> <span class="n">samples_loss</span></div>
<span class="c1"># =============================================================================</span>
<div class="viewcode-block" id="plot_pruning_iterative_data"><a class="viewcode-back" href="../../../../_autosummary/hookeai.miscellaneous.pruning.pruning_dataset.plot_pruning_iterative_data.html#hookeai.miscellaneous.pruning.pruning_dataset.plot_pruning_iterative_data">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">plot_pruning_iterative_data</span><span class="p">(</span>
        <span class="n">pruning_dir</span><span class="p">,</span> <span class="n">pruning_params</span><span class="p">,</span> <span class="n">testing_types</span><span class="p">,</span> <span class="n">pruning_iterative_data</span><span class="p">,</span>
        <span class="n">performance_threshold_ratio</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">is_plot_performance_threshold</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">save_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_save_fig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">is_stdout_display</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">is_latex</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot pruning iterative data.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pruning_dir : str</span>
<span class="sd">        Pruning main directory.</span>
<span class="sd">    pruning_params : dict</span>
<span class="sd">        Pruning parameters.</span>
<span class="sd">    testing_types : tuple[str]</span>
<span class="sd">        Types of testing data sets used to assess the performance of the model</span>
<span class="sd">        trained on the pruned training data sets.</span>
<span class="sd">    pruning_iterative_data : dict</span>
<span class="sd">        Pruning iterative data (item, dict) for each pruning iteration</span>
<span class="sd">        (key, str). </span>
<span class="sd">    performance_threshold_ratio : float, default=0.1</span>
<span class="sd">        Performance degradation threshold ratio. Defines a relative increase</span>
<span class="sd">        with the respect to the testing loss obtained with the largest training</span>
<span class="sd">        data set size. Data that can be pruned without exceeding the</span>
<span class="sd">        performance degradation threshold is considered redundant.</span>
<span class="sd">    is_plot_performance_threshold : bool, default=False</span>
<span class="sd">        If True, then plot performance degradation threshold. </span>
<span class="sd">    save_dir : str, default=None</span>
<span class="sd">        Directory where data set plots are saved. If None, then plots are</span>
<span class="sd">        saved in current working directory.</span>
<span class="sd">    is_save_fig : bool, default=False</span>
<span class="sd">        Save figure.</span>
<span class="sd">    is_stdout_display : bool, default=False</span>
<span class="sd">        True if displaying figure to standard output device, False otherwise.</span>
<span class="sd">    is_latex : bool, default=False</span>
<span class="sd">        If True, then render all strings in LaTeX. If LaTex is not available,</span>
<span class="sd">        then this option is silently set to False and all input strings are</span>
<span class="sd">        processed to remove $(...)$ enclosure.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set plot marker size</span>
    <span class="n">markersize</span> <span class="o">=</span> <span class="mf">3.0</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Get full data set size</span>
    <span class="n">n_full</span> <span class="o">=</span> <span class="n">pruning_params</span><span class="p">[</span><span class="s1">&#39;n_full&#39;</span><span class="p">]</span>
    <span class="c1"># Get number of pruning iterations</span>
    <span class="n">n_iter</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pruning_iterative_data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Initialize data array</span>
    <span class="n">data_xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_iter</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Loop over pruning iterations</span>
    <span class="k">for</span> <span class="nb">iter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_iter</span><span class="p">):</span>
        <span class="c1"># Get pruning iteration data</span>
        <span class="n">iter_data</span> <span class="o">=</span> <span class="n">pruning_iterative_data</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">iter</span><span class="p">)]</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Get iteration development data set size</span>
        <span class="n">n_dev</span> <span class="o">=</span> <span class="n">iter_data</span><span class="p">[</span><span class="s1">&#39;n_dev&#39;</span><span class="p">]</span>
        <span class="n">ratio_dev_pc</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_dev</span><span class="o">/</span><span class="n">n_full</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
        <span class="c1"># Compute training data set size</span>
        <span class="n">n_train</span> <span class="o">=</span> <span class="n">iter_data</span><span class="p">[</span><span class="s1">&#39;n_train&#39;</span><span class="p">]</span>
        <span class="n">ratio_train_pc</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_train</span><span class="o">/</span><span class="n">n_full</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
        <span class="c1"># Compute validation data set size</span>
        <span class="n">n_valid</span> <span class="o">=</span> <span class="n">iter_data</span><span class="p">[</span><span class="s1">&#39;n_valid&#39;</span><span class="p">]</span>
        <span class="n">ratio_valid_pc</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_valid</span><span class="o">/</span><span class="n">n_full</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
        <span class="c1"># Compute unused data set size</span>
        <span class="n">n_unused</span> <span class="o">=</span> <span class="n">iter_data</span><span class="p">[</span><span class="s1">&#39;n_unused&#39;</span><span class="p">]</span>
        <span class="n">ratio_unused_pc</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_unused</span><span class="o">/</span><span class="n">n_full</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Assemble iteration data</span>
        <span class="n">data_xy</span><span class="p">[</span><span class="nb">iter</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> \
            <span class="p">(</span><span class="nb">iter</span><span class="p">,</span> <span class="n">ratio_dev_pc</span><span class="p">,</span> <span class="nb">iter</span><span class="p">,</span> <span class="n">ratio_train_pc</span><span class="p">,</span> <span class="nb">iter</span><span class="p">,</span> <span class="n">ratio_valid_pc</span><span class="p">,</span>
             <span class="nb">iter</span><span class="p">,</span> <span class="n">ratio_unused_pc</span><span class="p">)</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Set data labels</span>
        <span class="n">data_labels</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Training + Validation&#39;</span><span class="p">,</span> <span class="s1">&#39;Training&#39;</span><span class="p">,</span> <span class="s1">&#39;Validation&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Unused&#39;</span><span class="p">)</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Set axes labels</span>
        <span class="n">x_label</span> <span class="o">=</span> <span class="s1">&#39;Pruning iterations&#39;</span>
        <span class="n">y_label</span> <span class="o">=</span> <span class="s1">&#39;\</span><span class="si">% o</span><span class="s1">f full data set&#39;</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Set axes limits and scale</span>
        <span class="n">x_lims</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">y_lims</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">120</span><span class="p">)</span>
        <span class="n">x_scale</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span>
        <span class="n">y_scale</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Plot data</span>
        <span class="n">figure</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plot_xy_data</span><span class="p">(</span>
            <span class="n">data_xy</span><span class="p">,</span> <span class="n">data_labels</span><span class="o">=</span><span class="n">data_labels</span><span class="p">,</span> <span class="n">x_lims</span><span class="o">=</span><span class="n">x_lims</span><span class="p">,</span> <span class="n">y_lims</span><span class="o">=</span><span class="n">y_lims</span><span class="p">,</span>
            <span class="n">x_label</span><span class="o">=</span><span class="n">x_label</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="n">y_label</span><span class="p">,</span> <span class="n">x_scale</span><span class="o">=</span><span class="n">x_scale</span><span class="p">,</span> <span class="n">y_scale</span><span class="o">=</span><span class="n">y_scale</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span> <span class="n">is_latex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Set filename</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;pruning_iterations_dataset_sizes&#39;</span>
        <span class="c1"># Save figure</span>
        <span class="k">if</span> <span class="n">is_save_fig</span><span class="p">:</span>
            <span class="n">save_figure</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">save_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">)</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Display figure</span>
        <span class="k">if</span> <span class="n">is_stdout_display</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Close plot</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Set performance metric</span>
    <span class="n">performance_metric</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;testing_loss&#39;</span><span class="p">,</span> <span class="s1">&#39;testing_avg_nrmse&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Initialize data array</span>
    <span class="n">data_xy_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">n_iter</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">fill_value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="c1"># Loop over testing types</span>
    <span class="k">for</span> <span class="n">testing_type</span> <span class="ow">in</span> <span class="n">testing_types</span><span class="p">:</span>
        <span class="c1"># Initialize data array</span>
        <span class="n">data_xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">n_iter</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">fill_value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Loop over pruning iterations</span>
        <span class="k">for</span> <span class="nb">iter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_iter</span><span class="p">):</span>
            <span class="c1"># Get pruning iteration data</span>
            <span class="n">iter_data</span> <span class="o">=</span> <span class="n">pruning_iterative_data</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">iter</span><span class="p">)]</span>
            <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
            <span class="c1"># Get iteration development data set size</span>
            <span class="n">n_dev</span> <span class="o">=</span> <span class="n">iter_data</span><span class="p">[</span><span class="s1">&#39;n_dev&#39;</span><span class="p">]</span>
            <span class="n">ratio_dev_pc</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_dev</span><span class="o">/</span><span class="n">n_full</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
            <span class="c1"># Get iteration performance metric</span>
            <span class="k">if</span> <span class="n">performance_metric</span> <span class="o">==</span> <span class="s1">&#39;testing_avg_nrmse&#39;</span><span class="p">:</span>
                <span class="c1"># Get iteration average prediction NRMSE</span>
                <span class="n">avg_predict_loss</span> <span class="o">=</span> \
                    <span class="n">iter_data</span><span class="p">[</span><span class="s1">&#39;testing_types_avg_nrmse&#39;</span><span class="p">][</span><span class="n">testing_type</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Get iteration testing loss</span>
                <span class="n">avg_predict_loss</span> <span class="o">=</span> \
                    <span class="n">iter_data</span><span class="p">[</span><span class="s1">&#39;testing_types_loss&#39;</span><span class="p">][</span><span class="n">testing_type</span><span class="p">]</span>
            <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
            <span class="c1"># Assemble iteration data</span>
            <span class="n">data_xy</span><span class="p">[</span><span class="nb">iter</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratio_dev_pc</span>
            <span class="n">data_xy</span><span class="p">[</span><span class="nb">iter</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">avg_predict_loss</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Set x-axis label</span>
        <span class="n">x_label</span> <span class="o">=</span> <span class="s1">&#39;\</span><span class="si">% o</span><span class="s1">f full data set&#39;</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Set y-axis label, and axes limits and scale</span>
        <span class="k">if</span> <span class="n">performance_metric</span> <span class="o">==</span> <span class="s1">&#39;testing_avg_nrmse&#39;</span><span class="p">:</span>
            <span class="n">y_label</span> <span class="o">=</span> <span class="s1">&#39;Avg. NRMSE&#39;</span>
            <span class="n">x_lims</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">y_lims</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">x_scale</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span>
            <span class="n">y_scale</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y_label</span> <span class="o">=</span> <span class="s1">&#39;Avg. prediction loss (MSE)&#39;</span>
            <span class="n">x_lims</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">y_lims</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1e1</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">)</span>
            <span class="n">x_scale</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span>
            <span class="n">y_scale</span> <span class="o">=</span> <span class="s1">&#39;log&#39;</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Plot data</span>
        <span class="n">figure</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plot_xy_data</span><span class="p">(</span>
            <span class="n">data_xy</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="n">x_label</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="n">y_label</span><span class="p">,</span> <span class="n">x_lims</span><span class="o">=</span><span class="n">x_lims</span><span class="p">,</span>
            <span class="n">y_lims</span><span class="o">=</span><span class="n">y_lims</span><span class="p">,</span> <span class="n">x_scale</span><span class="o">=</span><span class="n">x_scale</span><span class="p">,</span> <span class="n">y_scale</span><span class="o">=</span><span class="n">y_scale</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span> <span class="n">is_latex</span><span class="o">=</span><span class="n">is_latex</span><span class="p">)</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Plot performance degradation threshold</span>
        <span class="k">if</span> <span class="n">is_plot_performance_threshold</span> <span class="ow">and</span> <span class="n">testing_type</span> <span class="o">!=</span> <span class="s1">&#39;unused_data&#39;</span><span class="p">:</span>
            <span class="c1"># Compute performance degradation threshold</span>
            <span class="n">performance_threshold</span> <span class="o">=</span> \
                <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">performance_threshold_ratio</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">data_xy</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="c1"># Set label</span>
            <span class="n">performance_threshold_label</span> <span class="o">=</span> \
                <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Performance threshold (&#39;</span>
                 <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">performance_threshold_ratio</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s1">.0f</span><span class="si">}</span><span class="s1">\%)&#39;</span><span class="p">)</span>
            <span class="c1"># Plot performance degradation threshold</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">performance_threshold</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                         <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">performance_threshold_label</span><span class="p">)</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Plot legend if there are data labels</span>
        <span class="k">if</span> <span class="n">axes</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;inherit&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;inherit&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                        <span class="n">framealpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Set filename</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;pruning_testing_convergence_</span><span class="si">{</span><span class="n">testing_type</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="c1"># Save figure</span>
        <span class="k">if</span> <span class="n">is_save_fig</span><span class="p">:</span>
            <span class="n">save_figure</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">save_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">)</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Display figure</span>
        <span class="k">if</span> <span class="n">is_stdout_display</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Close plot</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Store testing type data</span>
        <span class="n">data_xy_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">data_xy_all</span><span class="p">,</span> <span class="n">data_xy</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Set data labels mapping</span>
    <span class="n">data_labels_map</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;in_distribution&#39;</span><span class="p">:</span> <span class="s1">&#39;In-distribution&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;out_distribution&#39;</span><span class="p">:</span> <span class="s1">&#39;Out-of-distribution&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;unused_data&#39;</span><span class="p">:</span> <span class="s1">&#39;Unused&#39;</span><span class="p">}</span>
    <span class="c1"># Set data labels</span>
    <span class="n">data_labels</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">data_labels_map</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">testing_types</span><span class="p">])</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Plot data</span>
    <span class="n">figure</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plot_xy_data</span><span class="p">(</span>
        <span class="n">data_xy_all</span><span class="p">,</span> <span class="n">data_labels</span><span class="o">=</span><span class="n">data_labels</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="n">x_label</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="n">y_label</span><span class="p">,</span>
        <span class="n">x_lims</span><span class="o">=</span><span class="n">x_lims</span><span class="p">,</span> <span class="n">y_lims</span><span class="o">=</span><span class="n">y_lims</span><span class="p">,</span> <span class="n">x_scale</span><span class="o">=</span><span class="n">x_scale</span><span class="p">,</span> <span class="n">y_scale</span><span class="o">=</span><span class="n">y_scale</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span> <span class="n">is_latex</span><span class="o">=</span><span class="n">is_latex</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Set filename</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;pruning_testing_convergence&#39;</span>
    <span class="c1"># Save figure</span>
    <span class="k">if</span> <span class="n">is_save_fig</span><span class="p">:</span>
        <span class="n">save_figure</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">save_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Display figure</span>
    <span class="k">if</span> <span class="n">is_stdout_display</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Close plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span></div>
<span class="c1"># =============================================================================</span>
<div class="viewcode-block" id="display_pruning_data"><a class="viewcode-back" href="../../../../_autosummary/hookeai.miscellaneous.pruning.pruning_dataset.display_pruning_data.html#hookeai.miscellaneous.pruning.pruning_dataset.display_pruning_data">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">display_pruning_data</span><span class="p">(</span><span class="n">pruning_data_file_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display data from pruning data file.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pruning_data_file_path : str</span>
<span class="sd">        Pruning data file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Display time series data set pruning data&#39;</span>
          <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">-----------------------------------------&#39;</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Load pruning data</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">pruning_data_file_path</span><span class="p">):</span>
        <span class="c1"># Load pruning data</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pruning_data_file_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pruning_file</span><span class="p">:</span>
            <span class="n">pruning_data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">pruning_file</span><span class="p">)</span>
        <span class="c1"># Collect pruning data</span>
        <span class="n">pruning_params</span> <span class="o">=</span> <span class="n">pruning_data</span><span class="p">[</span><span class="s1">&#39;pruning_params&#39;</span><span class="p">]</span>
        <span class="n">pruning_iterative_data</span> <span class="o">=</span> <span class="n">pruning_data</span><span class="p">[</span><span class="s1">&#39;pruning_iterative_data&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Pruning data file has not been found:</span><span class="se">\n\n</span><span class="s1">&#39;</span>
                            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">pruning_data_file_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Get number of pruning iterations</span>
    <span class="n">n_iter</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pruning_iterative_data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="c1"># Get testing types</span>
    <span class="n">testing_types</span> <span class="o">=</span> \
        <span class="nb">tuple</span><span class="p">(</span><span class="n">pruning_iterative_data</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">][</span><span class="s1">&#39;testing_types_loss&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Initialize iterative data</span>
    <span class="n">training_size</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">testing_types_loss</span> <span class="o">=</span> <span class="p">{</span><span class="n">testing_type</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">testing_type</span> <span class="ow">in</span> <span class="n">testing_types</span><span class="p">}</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Loop over pruning iterations</span>
    <span class="k">for</span> <span class="nb">iter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_iter</span><span class="p">):</span>
        <span class="c1"># Get pruning iteration data</span>
        <span class="n">iter_data</span> <span class="o">=</span> <span class="n">pruning_iterative_data</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">iter</span><span class="p">)]</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Collect training data set size</span>
        <span class="n">training_size</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iter_data</span><span class="p">[</span><span class="s1">&#39;n_train&#39;</span><span class="p">])</span>
        <span class="c1"># Loop over testing types</span>
        <span class="k">for</span> <span class="n">testing_type</span> <span class="ow">in</span> <span class="n">testing_types</span><span class="p">:</span>
            <span class="c1"># Get testing loss</span>
            <span class="n">testing_loss</span> <span class="o">=</span> <span class="n">iter_data</span><span class="p">[</span><span class="s1">&#39;testing_types_loss&#39;</span><span class="p">][</span><span class="n">testing_type</span><span class="p">]</span>
            <span class="c1"># Collect testing loss</span>
            <span class="n">testing_types_loss</span><span class="p">[</span><span class="n">testing_type</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">testing_loss</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Display</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&gt; Training data set size:</span><span class="se">\n\n</span><span class="s1">&#39;</span>
          <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">training_size</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">testing_type</span> <span class="ow">in</span> <span class="n">testing_types</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&gt; Testing loss (</span><span class="si">{</span><span class="n">testing_type</span><span class="si">}</span><span class="s1">):</span><span class="se">\n\n</span><span class="s1">&#39;</span>
              <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">testing_types_loss</span><span class="p">[</span><span class="n">testing_type</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="nb">print</span><span class="p">()</span></div>
<span class="c1"># =============================================================================</span>
<div class="viewcode-block" id="preview_pruning_iterations"><a class="viewcode-back" href="../../../../_autosummary/hookeai.miscellaneous.pruning.pruning_dataset.preview_pruning_iterations.html#hookeai.miscellaneous.pruning.pruning_dataset.preview_pruning_iterations">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">preview_pruning_iterations</span><span class="p">(</span><span class="n">pruning_dir</span><span class="p">,</span> <span class="n">pruning_params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Preview pruning iterations.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pruning_dir : str</span>
<span class="sd">        Pruning main directory.</span>
<span class="sd">    pruning_params : dict, default=None</span>
<span class="sd">        Pruning parameters. If None, then a default set of pruning parameters</span>
<span class="sd">        is adopted.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Preview - Time series data set pruning&#39;</span>
          <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">--------------------------------------&#39;</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Set full data set directory</span>
    <span class="n">full_dataset_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">pruning_dir</span><span class="p">),</span>
                                    <span class="s1">&#39;base_datasets&#39;</span><span class="p">,</span> <span class="s1">&#39;1_training_dataset&#39;</span><span class="p">)</span>
    <span class="c1"># Check full data set directory</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">full_dataset_dir</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;The full data set directory has not been found:&#39;</span>
                           <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">full_dataset_dir</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Load full data set</span>
    <span class="n">full_dataset</span> <span class="o">=</span> <span class="n">load_full_dataset</span><span class="p">(</span><span class="n">full_dataset_dir</span><span class="p">)</span>
    <span class="c1"># Get full data set size</span>
    <span class="n">n_full</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">full_dataset</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Get default pruning parameters</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pruning_params</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">pruning_params</span> <span class="o">=</span> <span class="n">set_default_pruning_parameters</span><span class="p">()</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Get pruning scheduler type</span>
    <span class="n">prun_scheduler_type</span> <span class="o">=</span> <span class="n">pruning_params</span><span class="p">[</span><span class="s1">&#39;prun_scheduler_type&#39;</span><span class="p">]</span>
    <span class="c1"># Get pruning scheduler type parameters</span>
    <span class="n">prun_scheduler_params</span> <span class="o">=</span> <span class="n">pruning_params</span><span class="p">[</span><span class="s1">&#39;prun_scheduler_params&#39;</span><span class="p">]</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Get maximum number of pruning iterations</span>
    <span class="n">n_iter_max</span> <span class="o">=</span> <span class="n">pruning_params</span><span class="p">[</span><span class="s1">&#39;n_iter_max&#39;</span><span class="p">]</span>
    <span class="c1"># Get pruning iteration data set split sizes</span>
    <span class="n">pruning_iter_sizes</span> <span class="o">=</span> <span class="n">pruning_params</span><span class="p">[</span><span class="s1">&#39;pruning_iter_sizes&#39;</span><span class="p">]</span>
    <span class="c1"># Get minimum development data set size</span>
    <span class="n">n_dev_min</span> <span class="o">=</span> <span class="n">pruning_params</span><span class="p">[</span><span class="s1">&#39;n_dev_min&#39;</span><span class="p">]</span>
    <span class="c1"># Get minimum development data set size ratio</span>
    <span class="n">ratio_dev_min</span> <span class="o">=</span> <span class="n">pruning_params</span><span class="p">[</span><span class="s1">&#39;ratio_dev_min&#39;</span><span class="p">]</span>
    <span class="c1"># Get minimum pruning testing data set size</span>
    <span class="n">n_prun_test_min</span> <span class="o">=</span> <span class="n">pruning_params</span><span class="p">[</span><span class="s1">&#39;n_prun_test_min&#39;</span><span class="p">]</span>
    <span class="c1"># Get maximum pruned samples testing ratio</span>
    <span class="n">prun_test_ratio_max</span> <span class="o">=</span> <span class="n">pruning_params</span><span class="p">[</span><span class="s1">&#39;prun_test_ratio_max&#39;</span><span class="p">]</span>
    <span class="c1"># Get pruning step data set split sizes</span>
    <span class="n">pruning_step_sizes</span> <span class="o">=</span> <span class="n">pruning_params</span><span class="p">[</span><span class="s1">&#39;pruning_step_sizes&#39;</span><span class="p">]</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Display</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&gt; Full data set size: </span><span class="si">{</span><span class="n">n_full</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&gt; Maximum number of pruning iterations: </span><span class="si">{</span><span class="n">n_iter_max</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&gt; Minimum development data set size: </span><span class="si">{</span><span class="n">n_dev_min</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&gt; Minimum development data set size ratio: </span><span class="si">{</span><span class="n">ratio_dev_min</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&gt; Minimum pruning testing data set size: </span><span class="si">{</span><span class="n">n_prun_test_min</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&gt; Maximum pruned samples testing ratio: </span><span class="si">{</span><span class="n">prun_test_ratio_max</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Display</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&gt; Data set pruning iterations:&#39;</span><span class="p">)</span>
    <span class="n">size_sep</span> <span class="o">=</span> <span class="mi">59</span><span class="o">*</span><span class="s1">&#39;-&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="s2">&quot;Data sets&quot;</span><span class="si">:</span><span class="s1">&gt;44s</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
          <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="n">size_sep</span><span class="si">:</span><span class="s1">&gt;71s</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
          <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="s2">&quot;iter&quot;</span><span class="si">:</span><span class="s1">&gt;6s</span><span class="si">}</span><span class="s1"> &#39;</span>
          <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot;dev&quot;</span><span class="si">:</span><span class="s1">&gt;8s</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2">ull&quot;</span><span class="si">:</span><span class="s1">&gt;6s</span><span class="si">}</span><span class="s1"> &#39;</span>
          <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot;train&quot;</span><span class="si">:</span><span class="s1">&gt;8s</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2">ull&quot;</span><span class="si">:</span><span class="s1">&gt;6s</span><span class="si">}</span><span class="s1"> &#39;</span>
          <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot;valid&quot;</span><span class="si">:</span><span class="s1">&gt;8s</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2">ull&quot;</span><span class="si">:</span><span class="s1">&gt;6s</span><span class="si">}</span><span class="s1"> &#39;</span>
          <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot;unused&quot;</span><span class="si">:</span><span class="s1">&gt;9s</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2">ull&quot;</span><span class="si">:</span><span class="s1">&gt;6s</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Initialize pruning iteration counter</span>
    <span class="nb">iter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Initialize pruning termination flag</span>
    <span class="n">is_keep_pruning</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># Loop over iterations</span>
    <span class="k">while</span> <span class="n">is_keep_pruning</span><span class="p">:</span>
        <span class="c1"># Compute development data set size</span>
        <span class="k">if</span> <span class="nb">iter</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">n_dev</span> <span class="o">=</span> <span class="n">n_full</span>
            <span class="n">ratio_dev_pc</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_dev</span><span class="o">/</span><span class="n">n_full</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
            <span class="n">n_unused</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">ratio_unused_pc</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_unused</span><span class="o">/</span><span class="n">n_full</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Create dummy development dataset</span>
            <span class="n">dev_dataset</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_dev</span><span class="p">)]</span>
            <span class="c1"># Get number of pruned samples</span>
            <span class="n">n_prun_sample</span> <span class="o">=</span> <span class="n">get_n_prun_sample</span><span class="p">(</span>
                <span class="n">prun_scheduler_type</span><span class="p">,</span> <span class="n">prun_scheduler_params</span><span class="p">,</span> <span class="n">dev_dataset</span><span class="p">)</span>
            <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
            <span class="c1"># Compute pruning training data set size</span>
            <span class="n">n_prun_train</span> <span class="o">=</span> \
                <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">pruning_step_sizes</span><span class="p">[</span><span class="s1">&#39;training&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">n_dev</span><span class="p">))</span>
            <span class="c1"># Compute pruning validation data set size</span>
            <span class="n">n_prun_valid</span> <span class="o">=</span> \
                <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">pruning_step_sizes</span><span class="p">[</span><span class="s1">&#39;validation&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">n_dev</span><span class="p">))</span>
            <span class="c1"># Compute pruning testing data set size</span>
            <span class="n">n_prun_test</span> <span class="o">=</span> <span class="n">n_dev</span> <span class="o">-</span> <span class="p">(</span><span class="n">n_prun_train</span> <span class="o">+</span> <span class="n">n_prun_valid</span><span class="p">)</span>
            <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
            <span class="c1"># Display pruning step</span>
            <span class="k">if</span> <span class="nb">iter</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="mi">17</span><span class="o">*</span><span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;(pruning step: &#39;</span>
                      <span class="sa">f</span><span class="s1">&#39;n_prun = </span><span class="si">{</span><span class="n">n_prun_sample</span><span class="si">}</span><span class="s1">, &#39;</span>
                      <span class="sa">f</span><span class="s1">&#39;T</span><span class="si">{</span><span class="n">n_prun_train</span><span class="si">}</span><span class="s1">|V</span><span class="si">{</span><span class="n">n_prun_valid</span><span class="si">}</span><span class="s1">|T</span><span class="si">{</span><span class="n">n_prun_test</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
            <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
            <span class="c1"># Initialize pruning step status</span>
            <span class="n">step_status</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># Check pruning step admissibility</span>
            <span class="k">if</span> <span class="n">n_dev</span> <span class="o">&lt;=</span> <span class="n">n_dev_min</span><span class="p">:</span>
                <span class="n">step_status</span> <span class="o">=</span> <span class="s1">&#39;Minimum development data set size reached.&#39;</span>
            <span class="k">elif</span> <span class="n">n_dev</span><span class="o">/</span><span class="n">n_full</span> <span class="o">&lt;=</span> <span class="n">ratio_dev_min</span><span class="p">:</span>
                <span class="n">step_status</span> <span class="o">=</span> \
                    <span class="s1">&#39;Minimum development data set size ratio reached.&#39;</span>
            <span class="k">elif</span> <span class="n">n_prun_test</span> <span class="o">&lt;</span> <span class="n">n_prun_test_min</span><span class="p">:</span>
                <span class="n">step_status</span> <span class="o">=</span> <span class="s1">&#39;Minimum pruning testing data set size reached.&#39;</span>
            <span class="k">elif</span> <span class="n">n_prun_sample</span><span class="o">/</span><span class="n">n_prun_test</span> <span class="o">&gt;</span> <span class="n">prun_test_ratio_max</span><span class="p">:</span>
                <span class="n">step_status</span> <span class="o">=</span> <span class="s1">&#39;Maximum pruned samples testing ratio reached.&#39;</span>
            <span class="c1"># Set pruning step admissibility</span>
            <span class="k">if</span> <span class="n">step_status</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">is_valid_pruning_step</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">is_valid_pruning_step</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
            <span class="c1"># Check pruning step admissibility</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_valid_pruning_step</span><span class="p">:</span>
                <span class="c1"># Set termination status</span>
                <span class="n">termination_status</span> <span class="o">=</span> <span class="n">step_status</span>
                <span class="c1"># Terminate pruning</span>
                <span class="n">is_keep_pruning</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">continue</span>
            <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
            <span class="c1"># Update development data set size</span>
            <span class="n">n_dev</span> <span class="o">=</span> <span class="n">n_dev</span> <span class="o">-</span> <span class="n">n_prun_sample</span>
            <span class="n">ratio_dev_pc</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_dev</span><span class="o">/</span><span class="n">n_full</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
            <span class="c1"># Update unused data set size</span>
            <span class="n">n_unused</span> <span class="o">+=</span> <span class="n">n_prun_sample</span>
            <span class="n">ratio_unused_pc</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_unused</span><span class="o">/</span><span class="n">n_full</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Compute training data set size</span>
        <span class="n">n_train</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">pruning_iter_sizes</span><span class="p">[</span><span class="s1">&#39;training&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">n_dev</span><span class="p">))</span>
        <span class="n">ratio_train_pc</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_train</span><span class="o">/</span><span class="n">n_full</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
        <span class="c1"># Compute validation data set size</span>
        <span class="n">n_valid</span> <span class="o">=</span> <span class="n">n_dev</span> <span class="o">-</span> <span class="n">n_train</span>
        <span class="n">ratio_valid_pc</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_valid</span><span class="o">/</span><span class="n">n_full</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Display pruning iteration</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">iter</span><span class="si">:</span><span class="s1">&gt;6d</span><span class="si">}</span><span class="s1"> &#39;</span>
              <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">n_dev</span><span class="si">:</span><span class="s1">&gt;8d</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">ratio_dev_pc</span><span class="si">:</span><span class="s1">&gt;6.1f</span><span class="si">}</span><span class="s1"> &#39;</span>
              <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">n_train</span><span class="si">:</span><span class="s1">&gt;8d</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">ratio_train_pc</span><span class="si">:</span><span class="s1">&gt;6.1f</span><span class="si">}</span><span class="s1"> &#39;</span>
              <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">n_valid</span><span class="si">:</span><span class="s1">&gt;8d</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">ratio_valid_pc</span><span class="si">:</span><span class="s1">&gt;6.1f</span><span class="si">}</span><span class="s1"> &#39;</span>
              <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">n_unused</span><span class="si">:</span><span class="s1">&gt;9d</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">ratio_unused_pc</span><span class="si">:</span><span class="s1">&gt;6.1f</span><span class="si">}</span><span class="s1"> &#39;</span><span class="p">)</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Check pruning iterations</span>
        <span class="k">if</span> <span class="nb">iter</span> <span class="o">&gt;=</span> <span class="n">n_iter_max</span><span class="p">:</span>
            <span class="c1"># Set termination status</span>
            <span class="n">termination_status</span> <span class="o">=</span> \
                <span class="s1">&#39;Maximum number of pruning iterations reached.&#39;</span>
            <span class="c1"># Terminate pruning</span>
            <span class="n">is_keep_pruning</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Update pruning iteration counter</span>
            <span class="nb">iter</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&gt; Termination status: </span><span class="si">{</span><span class="n">termination_status</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>
<span class="c1"># =============================================================================</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1"># Set computation processes</span>
    <span class="n">is_pruning_preview</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">is_dataset_pruning</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">is_plot_pruning</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">is_display_pruning_data</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Set pruning main directory</span>
    <span class="n">pruning_dir</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;/home/username/Documents/brown/projects/&#39;</span>
                   <span class="s1">&#39;test_pruning/polynomial&#39;</span><span class="p">)</span>
    <span class="c1"># Set types of testing data sets</span>
    <span class="n">testing_types</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;in_distribution&#39;</span><span class="p">,</span> <span class="s1">&#39;unused_data&#39;</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Set device type</span>
    <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
        <span class="n">device_type</span> <span class="o">=</span> <span class="s1">&#39;cuda&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">device_type</span> <span class="o">=</span> <span class="s1">&#39;cpu&#39;</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Pruning preview</span>
    <span class="k">if</span> <span class="n">is_pruning_preview</span><span class="p">:</span>
        <span class="n">preview_pruning_iterations</span><span class="p">(</span><span class="n">pruning_dir</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Data set pruning</span>
    <span class="k">if</span> <span class="n">is_dataset_pruning</span><span class="p">:</span>
        <span class="c1"># Prune time series data set</span>
        <span class="n">pruning_params</span><span class="p">,</span> <span class="n">pruning_iterative_data</span> <span class="o">=</span> <span class="n">prune_time_series_dataset</span><span class="p">(</span>
            <span class="n">pruning_dir</span><span class="p">,</span> <span class="n">testing_types</span><span class="p">,</span> <span class="n">is_remove_pruning_models</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">device_type</span><span class="o">=</span><span class="n">device_type</span><span class="p">,</span> <span class="n">is_verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Pruning plot</span>
    <span class="k">if</span> <span class="n">is_plot_pruning</span><span class="p">:</span>
        <span class="c1"># Set pruning data file path</span>
        <span class="n">pruning_data_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">pruning_dir</span><span class="p">),</span>
                                              <span class="s1">&#39;pruning_data.pkl&#39;</span><span class="p">)</span>
        <span class="c1"># Load pruning data</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">pruning_data_file_path</span><span class="p">):</span>
            <span class="c1"># Load pruning data</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pruning_data_file_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pruning_file</span><span class="p">:</span>
                <span class="n">pruning_data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">pruning_file</span><span class="p">)</span>
            <span class="c1"># Collect pruning data</span>
            <span class="n">pruning_params</span> <span class="o">=</span> <span class="n">pruning_data</span><span class="p">[</span><span class="s1">&#39;pruning_params&#39;</span><span class="p">]</span>
            <span class="n">pruning_iterative_data</span> <span class="o">=</span> <span class="n">pruning_data</span><span class="p">[</span><span class="s1">&#39;pruning_iterative_data&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Pruning data file has not been found:</span><span class="se">\n\n</span><span class="s1">&#39;</span>
                               <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">pruning_data_file_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Set pruning plots directory</span>
        <span class="n">prun_plots_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">pruning_dir</span><span class="p">),</span> <span class="s1">&#39;plots&#39;</span><span class="p">)</span>
        <span class="c1"># Create pruning plots directory</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">prun_plots_dir</span><span class="p">):</span>
            <span class="n">make_directory</span><span class="p">(</span><span class="n">prun_plots_dir</span><span class="p">)</span>
        <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
        <span class="c1"># Plot pruning iterative data</span>
        <span class="n">plot_pruning_iterative_data</span><span class="p">(</span>
            <span class="n">pruning_dir</span><span class="p">,</span> <span class="n">pruning_params</span><span class="p">,</span> <span class="n">testing_types</span><span class="p">,</span> <span class="n">pruning_iterative_data</span><span class="p">,</span>
            <span class="n">is_plot_performance_threshold</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">save_dir</span><span class="o">=</span><span class="n">prun_plots_dir</span><span class="p">,</span> <span class="n">is_save_fig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">is_stdout_display</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">is_latex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Display pruning data</span>
    <span class="k">if</span> <span class="n">is_display_pruning_data</span><span class="p">:</span>
        <span class="c1"># Set pruning data file path</span>
        <span class="n">pruning_data_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">pruning_dir</span><span class="p">),</span>
                                              <span class="s1">&#39;pruning_data.pkl&#39;</span><span class="p">)</span>
        <span class="c1"># Display pruning data</span>
        <span class="n">display_pruning_data</span><span class="p">(</span><span class="n">pruning_data_file_path</span><span class="p">)</span>

    
    
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Bernardo Ferreira.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>